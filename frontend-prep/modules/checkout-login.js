define(["jquery","overlay","ajaxConfig"],function(e,t,n){function E(e){var t=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(e)}function S(t,n){e(t+" "+d).html(n)}function x(){var t=u.val(),n=a.val(),r=[];if(t===""){u.addClass("error");var i=e(b+" #error-emailblank").text();r.push(i)}else if(!E(t)){u.addClass("error");var i=e(b+" #error-emailwrong").text();r.push(i)}else u.removeClass("error");if(n===""){a.addClass("error");var i=e(b+" #error-pw").text();r.push(i)}else a.removeClass("error");return m.empty(),e.each(r,function(e,t){m.append("<span>"+t+"</span>")}),r.length===0}function T(t){e("html, body").animate({scrollTop:t.offset().top+"px"},0)}function N(){var t=f.val();if(t===""){var n=e(w+" #error-mailblank").text();return S(g,n),f.addClass("error"),!1}if(!E(t)){var n=e(w+" #error-mailwrong").text();return S(g,n),f.addClass("error").focus(),e(".breakpoint.small").css("display")=="block"&&T(f),!1}return!0}function C(){var t=h.val();if(t===""){var n=e(b+" #error-pw").text();return S(y,n),h.addClass("error").focus(),e(".breakpoint.small").css("display")=="block"&&T(h),!1}return!0}function k(){r.attr("disabled","disabled");var t=x();if(t){var i=e("#loginForm"),s;s=e.ajax({url:n.config()["CHECKOUT-LOGIN"],type:"POST",data:i.serialize(),dataType:"json"}),s.done(function(t){if(t.status==="ok")return window.location=hybris.contextPath+"/checkout/single",!0;var n=e(b+" #error-invalid").text();return S(v,n),u.addClass("error").focus(),a.addClass("error"),r.removeAttr("disabled"),e(".breakpoint.small").css("display")=="block"&&T(f),!1}),s.fail(function(e,t,n){r.removeAttr("disabled"),console.error("The following error occurred: "+t,n)})}else r.removeAttr("disabled");return!1}function L(){i.attr("disabled","disabled");var r=N();if(r){var s;s=e.ajax({url:n.config()["CHECKOUT-LOGIN-GUEST"],type:"POST",data:"email="+f.val()+"&subscribe="+l.is(":checked")+"&CSRFToken="+hybris.CSRFToken,dataType:"json"}),s.done(function(n){return n.status==="exists"?(f.removeClass("error"),S(g,""),S(y,""),t.open(p),i.removeAttr("disabled"),!1):(e("#guestForm").submit(),!0)}),s.fail(function(e,t,n){i.removeAttr("disabled"),console.error("The following error occurred: "+t,n)})}else i.removeAttr("disabled");return!1}function A(){s.attr("disabled","disabled");var t=C();if(t){var r;r=e.ajax({url:n.config()["CHECKOUT-LOGIN"],type:"POST",data:"j_username="+f.val()+"&j_password="+h.val()+"&subscribe="+l.is(":checked")+"&CSRFToken="+e("input:hidden[name=CSRFToken]").val(),dataType:"json"}),r.done(function(t){if(t.status==="ok")return window.location=hybris.contextPath+"/checkout/single",!0;var n=e(b+" #error-nomatch").text();return S(y,n),h.addClass("error").focus(),e(".breakpoint.small").css("display")=="block"&&T(h),s.removeAttr("disabled"),!1}),r.fail(function(e,t,n){s.removeAttr("disabled"),console.error("The following error occurred: "+t,n)})}else s.removeAttr("disabled");return!1}function O(){return e("#guestForm").submit(),!0}function M(){r.on("click touchstart",k),i.on("click touchstart",L),s.on("click touchstart",A),o.on("click touchstart",O)}var r=e(".continue-with-login"),i=e(".continue-without-login"),s=e(".continue-to-login"),o=e(".continue-as-guest"),u=e(".input-login-email"),a=e(".input-login-pwd"),f=e(".input-nologin-email"),l=e("#subscribe-newsletter"),c=e("#CSRFToken"),h=e(".input-nologin-pwd"),p="#login-overlay",d=".error-message",v="#loginForm",m=e(d,v),g=".guest-invited",y="#login-overlay",b="#login-error-messages",w="#guest-checkout-error-messages";return{load:function(){M()},checkForm:function(){return x()}}});
