define(["jquery","viewport","breakpoints","ajaxLoader","formEndpointValidation","ajaxConfig","handlebars","overlay","tooltip","billingAddress"],function(e,t,n,r,i,s,o,u,a,f){function Xt(){var t=Et.is(":checked");t?(St.removeClass(I),e(this).attr("checked","checked")):(St.addClass(I),e(this).removeAttr("checked"))}function Vt(){var t=e("option:selected",this).attr("data-country-code"),n={},r,i;if(t===undefined)return;r=gt.find("input"),i=gt.find("select:not(.checkout-payment-address-country)"),r.not(".keep-value").each(function(){e(this).removeClass("error"),e(this).not("[type=checkbox]").val("")}),i.each(function(){e(this).removeClass("error"),e(this).parents(".selectricWrapper").find(".selectric").removeClass("error"),e(this).find('option[value="0"]').prop("selected",!0),e(this).selectric("refresh")}),e(".global-errors-wrapper").empty(),n={country:t.toUpperCase()},f.obtainCountryFields(n)}function $t(t){var n={},r=e("body").hasClass("_fix-fixed");e(".checkout-error-messages",q).empty();switch(t.status){case"ok":yt.attr("action")===rt?Ut.addNewAddressCard(t.data):yt.attr("action")===it&&Ut.updateAddressCard(Wt.shippingId,t.data),r?setTimeout(function(){u.close(at)},200):u.close(at),yt.prop("action",rt),Qt(yt);break;case"validationError":var i=t.global_error_messages;return i!==undefined&&e(i).each(function(t,n){e(".checkout-error-messages",q).append('<li class="checkout-error-message empty-fields">'+n+"</li>")}),!1;case"addressError":var s=e(ct).html(),a=o.compile(s);return n.data=t.data,n.possibleAddresses=t.possible_addresses,an(n.possibleAddresses)?(un(n.possibleAddresses[0],!0),u.close(at)):(Pt.html(a(n)),zt=n,zt.endpoint=yt.attr("action"),zt.data=t.data,zt.possibleAddresses=t.possible_addresses,u.close(at),u.open(lt)),!1}}function Jt(e){Ut=e}function Kt(e){var t,n;yt.prop("action",it),bt.addClass(I),wt.removeClass(I),Mt.addClass(I),_t.removeClass(I),Dt.removeClass(I),Wt=e.data()}function Qt(t){e(".global-errCors-wrapper").hide(),e('.add-new-payment-address-form-renamed input[name="payment-billing-ignore-validation"]').val("false"),jt}function Gt(){e(".selectricWrapper",yt).filter(".selectricOpen").find("select").each(function(){e(this).selectric("close")})}function Yt(){var t=e(this),n=t.hasClass("error");n&&a.close(t.data("tooltip"))}function Zt(){var t=e(this),n=t.hasClass("error"),r=e("html").hasClass("iOS"),i=t,s=i.is("select"),o=i.data("tooltip");if(n){if(jt){e(".tooltip-message.error-text.error-small").remove();var u=e(".tooltip-message",o).clone(),f=i;u.addClass(It).insertAfter(f);var l=i.parent(".input-content");s&&l.length===0&&(l=i.parents(".input-content")),l.addClass(Ft)}else a.open(t.data("tooltip"));r&&e("header").css({position:"absolute"})}}function en(){kt.find('option[value="'+Rt+'"]').prop("selected",!0),kt.change(),kt.selectric("refresh"),Et.is(":checked")&&(Et.attr("checked",!1),Et.change()),xt.is(":checked")&&(xt.attr("checked",!1),xt.change()),Ot.attr("checked",!1),Ot.change()}function tn(e){zt.endpoint!==rt&&zt.endpoint===it&&Ut.updateAddressCard(Wt.shippingId,e),un(e,!0)}function nn(){Et.bind("change",Xt),kt.bind("change",Vt),Ht.on("focus",Zt),Ht.on("blur",Yt),Bt.on("click",function(){Gt()})}function rn(){u.onClose(function(t){e(":focus").trigger("blur"),t.attr("id")!==k&&t.attr("id")===A&&(e(pt,lt).off("click touchend"),e(ht,lt).off("click touchend")),bt.removeClass(I),wt.addClass(I),Mt.removeClass(I),_t.addClass(I),Dt.addClass(I)}),u.onOpen(function(t){e(":focus").trigger("blur"),t.attr("id")===A&&(e(pt,lt).on("click touchend",function(){var t=e("input[name=suggested-shipping-address]:checked",lt).val();tn(zt.possibleAddresses[t]),u.close(lt)}),e(ht,lt).on("click touchend",function(){tn(zt.data),u.close(lt)}))}),nn(),bt.removeClass(I),wt.addClass(I),Rt=yt.data("country"),e("#obtain_field_setting_url").val(vt),en(),yt.prop("action",rt),e("select",Bt).on("selectric-before-open",function(){Gt()}),e('.add-new-payment-address-form-renamed input[name="payment-billing-ignore-validation"]').val("false"),i.newInstance(yt,$t,$t,"tooltip")}function sn(){e("#obtain_field_setting_url").val(vt),yt.attr("action",rt),e("#billing_saved_id").val(""),e("#edit_address_id").val(""),Qt(yt),en()}function on(t,n){return Qt(yt),e("#billing_saved_id").val(t.data("shipping-id")),e("#edit_address_id").val(t.data("shipping-id")),e("#obtain_field_setting_url").val(mt),kt.find('option[value="'+t.data("shipping-country-code")+'"]').prop("selected",!0),kt.change(),kt.selectric("refresh"),u.open("#account-data-card-add-address-overlay"),!1}function un(t,n){t!==undefined&&(e.each(t,function(t,n){if(t!==undefined&&n!==undefined){var r=e('[name="'+t+'"]');r.length>0&&(r.is(":text")?r.val(n):r.is("select")&&(r.find('option[value="'+n+'"]').attr("selected",!0),r.selectric("refresh")))}}),n&&(e('.add-new-payment-address-form-renamed input[name="payment-billing-ignore-validation"]').val("true"),yt.unbind("submit"),i.newInstance(yt,$t,$t,"tooltip"),yt.trigger("submit")))}function an(e){return e!==undefined&&e[0].autoAccept?!0:!1}var l="add-new-payment-address-form-renamed",c="new-address-title",h="edit-address-title",p="address-business-address-checkbox",d="adca-address-form-business",v="address-alternative-phone",m="adca-address-form-alt-phone-country",g="adca-address-form-alt-phone",y="adca-address-form-alert-alt-phone",b="checkout-payment-address-country",w="address-country-phone",E="address-country-alt-phone",S="adca-address-form-input-state",x="us-state-container",T="it-state-container",N="address-states-us-label",C="address-states-it-label",k="account-data-card-add-address-overlay",L="account-data-address-add-overlay-content",A="address-not-found-overlay",O="address-book-error-address-not-found-overlay",M="adca-form-save-button",_="adca-form-change-button",D="adca-form-cancel-button",P="full-shipping-address-not-found-button",H="wire-shipping-address-not-found-button",B="adca-tooltip-zip-code-left",j="adca-tooltip-zip-code-right",F="adca-tooltip-zip-code",I="ckpy-hidden",q="."+l,R="."+c,U="."+h,z="."+p,W="."+d,X="."+v,V="."+m,$="."+g,J="."+y,K="."+b,Q="."+w,G="."+E,Y="."+S,Z="."+x,et="."+T,tt="."+N,nt="."+C,rt=s.getRemoteService("ADDRESS-BOOK-CARD-CREATE"),it=s.getRemoteService("ADDRESS-BOOK-CARD-UPDATE"),st="."+M,ot="."+_,ut="."+D,at="#"+k,ft="."+L,lt="#"+A,ct="#"+O,ht="."+H,pt="."+P,dt="#"+F,vt="CHECKOUT_PAYMENT_FORM_FIELDS",mt="ADDRESS-BOOK-CARD-UPDATE-FIELDS",gt=e(".adca-form-container-checkout-billing-address"),yt=e(q),bt=e(R),wt=e(U),Et=e(z,q),St=e(W,q),xt=e(X,q),Tt=e(V,q),Nt=e($,q),Ct=e(J,q),kt=e(K,q),Lt=e(Q,q),At=e(G,q),Ot=e('input[name="shipping-make-primary"]',q),Mt=e(st,q),_t=e(ot,q),Dt=e(ut,q),Pt=e(lt),Ht=e("input",yt),Bt=e(ft+".address-book"),jt=n.is("small"),Ft="error-state",It="error-small",qt,Rt,Ut,zt,Wt;return{load:rn(),setData:Kt,editAddress:on,addAddress:sn,setAccountCards:Jt}});
