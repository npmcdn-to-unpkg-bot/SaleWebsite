define(["jquery","overlay","formEndpointValidation","ajaxConfig","handlebars","addressBook","walletCreditCard"],function(e,t,n,r,i,s,o){function B(t){var n=_.map(function(){return e(this).outerHeight()}).get(),r=Math.max.apply(null,n),i=0;D===0&&(D=Math.min.apply(null,n)),n.length===1&&!t&&(D=P),i=r-D,T.animate({height:T.outerHeight()+i},200),M.animate({height:r},200),k.slideDown(200),D=r}function j(r){function l(){i.fadeOut(function(){e(this).remove(),B()})}var i=r.closest(T),s=r.context.control.defaultValue,o="#account-data-card-"+s,a=!1,f=!1;e(o+" .account-data-card-primary-link").hasClass("primary-selected")&&(f=!0),e(o).is(e("li.account-data-card-address:first"))&&(a=!0),f==1&&a==0&&location.reload(),e(".account-data-delete-card").each(function(){e(this).prop("checked",!1)}),e(".account-data-delete-card",i).prop("checked",!0),n.newInstance(L,function(){q(r)}),L.submit(),i.hasClass(u)?(t.open("#account-data-card-credit-deleted-overlay"),l()):l()}function F(n){var r=n.find("."+d).hasClass(d),i=".account-data-card-add-overlay",u=e('input[name="shipping-make-primary"]',i),f=e('input[name="payment-credit-card-primary"]',i);n.hasClass(a)?(s.setData(n),s.editAddress(n)):(o.setData(n),t.open("#account-data-card-add-credit-card-overlay"),f.prop("checked",r))}function I(){C.hasClass(f)&&(L.find("."+d).removeClass(d),L.find("."+f).addClass(d).removeClass(f))}function q(e){var t=e.parents(".account-data-card"),n=t.find("."+d).hasClass(d);n&&t.next().find(C).click()}function R(e){e.addClass(f),n.newInstance(L,I),L.submit()}function U(t){var n=e("script#address-book-address-card").html(),r=i.compile(n),s=r(t),o,u,a;x.find(".account-data-card-error").length>0?o=x.find(".account-data-card-error",x):o=x.find(".account-data-card-add",x),o.before(s),u=x.find("#"+p+t["shipping-id"]),a=e(".account-data-card-middle-content-inner",u);for(var l in t)u.attr("data-"+l,t[l]);C=e(E,x),T=e(".account-data-card",x),M=e(".account-data-card-middle-content",x),k=e(".account-data-card-primary-container",x),_=e(".account-data-card-middle-content-inner",x),u.find(E).on("click touchend",function(){V("primary","address"),R(e(this))}),u.find(".account-data-card-actions-delete").on("click touchend",function(){V("delete","address"),j(e(this))}),u.find(w).on("click touchend",function(){F(e(this).parents("li"))}),B(),t["shipping-make-primary"]&&(V("primary","address"),u.find(E).addClass(f),I())}function z(t,n){var r=e("script#address-book-address-middle-content").html(),s=i.compile(r),o=s(n),u,a;u=e("#"+p+t),a=e(".account-data-card-middle-content-inner",u),a.empty(),a.html(o);for(var l in n)u.attr("data-"+l,n[l]);B(!0),n["shipping-make-primary"]!==undefined&&n["shipping-make-primary"]?(u.find(E).addClass(f),I()):u.find(E).removeClass(d)}function W(t){var n=e("script#wallet-credit-card").html(),r=i.compile(n),s=r(t),o,u,a;x.find(".account-data-card-error").length>0?o=x.find(".account-data-card-error",x):o=x.find(".account-data-card-add",x),o.before(s),u=x.find("#"+p+t["payment-credit-card-id"]),a=e(".account-data-card-middle-content-inner",u);for(var f in t)u.attr("data-"+f,t[f]);C=e(E,x),T=e(".account-data-card",x),M=e(".account-data-card-middle-content",x),k=e(".account-data-card-primary-container",x),_=e(".account-data-card-middle-content-inner",x),u.find(E).on("click touchend",function(){V("primary","credit-card"),R(e(this))}),u.find(".account-data-card-actions-delete").on("click touchend",function(){V("delete","credit-card"),j(e(this))}),u.find(w).on("click touchend",function(){F(e(this).parents("li"))}),u.find(".account-data-delete-card").on("click",function(e){e.stopPropagation()}),B(),t["payment-credit-card-primary"]&&(V("primary","credit-card"),R(u.find(E))),x.find(".account-data-card-credit-card").length<3&&(V("primary","credit-card"),R(u.find(E)))}function X(t,n){var r=e("script#wallet-credit-card-middle-content").html(),s=i.compile(r),o=s(n),u,a;u=e("#"+p+t),a=e(".account-data-card-middle-content-inner",u),a.empty(),a.html(o);for(var f in n)u.attr("data-"+f,n[f]);B(!0),n["payment-credit-card-primary"]&&(V("primary","address"),R(u.find(E)))}function V(e,t){var n;t==="credit-card"&&e==="primary"?n=v:t==="credit-card"&&e==="delete"?n=g:t==="address"&&e==="primary"?n=m:t==="address"&&e==="delete"&&(n=b),L.prop("action",n)}function $(){C.on("click",function(){V("primary",H),R(e(this))}),e(".account-data-delete-card").on("click",function(e){e.stopPropagation()}),N.on("click",function(){V("delete",H),j(e(this))}),A.on("click",function(){F(e(this).parents("li"))}),O.on("click",function(){e(".checkout-error-messages li").remove(),e("#input-credit-card-number").removeClass("error"),e("#input-credit-card-number").next().removeClass("_active"),e('input[name="payment-credit-card-primary"]').prop("checked",!1),s.addAddress()})}var u="account-data-card-credit-card",a="account-data-card-address",f="account-data-card-primary",l="account-data-card-actions-edit",c="account-data-card-add-cta",h="account-data-card-primary-link",p="account-data-card-",d="primary-selected",v=r.getRemoteService("WALLET-MAKE-PRIMARY-CC"),m=r.getRemoteService("ADDRESS-BOOK-MAKE-PRIMARY"),g=r.getRemoteService("WALLET-DELETE-CARD-CC"),y=r.getRemoteService("ADDRESS-BOOK-DELETE-CARD"),b=r.getRemoteService("ADDRESS-BOOK-DELETE-ADDRESS"),w="."+l,E="."+h,S="."+c,x=e(".account-data-cards-wrapper"),T=e(".account-data-card",x),N=e(".account-data-card-actions-delete",x),C=e(E,x),k=e(".account-data-card-primary-container",x),L=e("#make-primary-card-form"),A=e(w,x),O=e(S,x),M=e(".account-data-card-middle-content",x),_=e(".account-data-card-middle-content-inner",x),D=0,P=113,H="";return{load:function(){e.find("section.wallet-wrapper").length?(x=e(".credit-card .account-data-cards-wrapper"),H="credit-card"):e.find("section.addres-book-wrapper")&&(x=e(".address .account-data-cards-wrapper"),H="address"),B(),$(),s.setAccountCards(this),o.setAccountCards(this)},sendPrimaryCard:R,addNewAddressCard:U,updateAddressCard:z,addNewCreditCardCard:W,updateCreditCardCard:X}});
