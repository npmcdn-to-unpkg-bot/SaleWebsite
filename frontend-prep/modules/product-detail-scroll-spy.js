define(["jquery","breakpoints","productDetail"],function(e,t,n){function I(){t.is("standard")?g=s:t.is("medium")&&(g=o),V(),j||(O=l.width(),p.css({position:"static",top:0})),A=f.height(),f.css({height:A,overflow:"visible"}),k=h.position().top-g,L=p.position().top+k,D=p.offset().top,e(window).ready(function(){K()}),F&&e("#article-overlay, #article-overlay-cta").remove();if(j){var n=0;d.length!==0?n=d.parent().next().offset().top:n=e(".detail-accordion").parent().next().offset().top;var r=c.position().top+v.height()+parseInt(e(".product-detail-accordion").css("marginTop").replace("px",""),10),i=H?c.position().top+p.height():n-m.offset().top;e(".purchase-column").css({height:r}),m.css({height:i}),a.addClass("product-detail-page")}u.width>=1200&&l.each(function(){var t=e(this).children(".item-content");t.attr("src",t.data("src_standard_retina"))})}function q(){u.on("scroll.productdetailscrollspy",e.proxy(X)).on("scrollingProductDetailCarousel",U).on("stopScrollingProductDetailCarousel",R),W(),X(),e(".accordion-button",c).on("click",function(){setTimeout(function(){if(j&&!H){var t=d.parent().next().offset().top-m.offset().top;m.css({height:t})}else e(document).ready(function(){K()})},500)}),e(".back-to-top").click(function(){U(),setTimeout(function(){n.updatePaginationActive(f,0),R(),X()},600)})}function R(){u.on("scroll.productdetailscrollspy",e.proxy(X))}function U(){}function z(){return c.offset().top}function W(){y=[],b=[],E=z(),S=g+E,a.find(x).map(function(){var t=e(this),n=parseInt(t.find(".carousel-pagination-link-index").text(),10)-1,r=l.eq(n);return[[r.offset().top-g,n]]||null}).sort(function(e,t){return e[0]-t[0]}).each(function(){y.push(this[0]),b.push(this[1])})}function X(){var t,r=w,i=u.scrollTop();T=i+g,C=J(),i>0&&e(".wrapper-move-down",f).fadeOut(),j?T>=E?v.addClass("_static-ios").css({top:E-80+"px"}):v.removeClass("_static-ios").removeAttr("style"):(G(),T<A&&Q(),et(),$(),Y());if(T>=S)return r!==(t=b[b.length-1])&&n.updatePaginationActive(f,t)&&(w=t);i<g&&n.updatePaginationActive(f,0);for(t=y.length;t--;)w!==b[t]&&T>=y[t]&&(y[t+1]===undefined||T<y[t+1])&&(n.updatePaginationActive(f,b[t]),w=b[t]);if(e(".product-detail-video-slide .play").is(":visible")){var s=e(".product-detail-carousel-pagination").css("marginTop");parseInt(s)<"-200"?e(".product-detail-video-slide .play").addClass("_disabled"):e(".product-detail-video-slide .play").removeClass("_disabled")}}function V(){var e=u.height(),t=e-f.offset().top-45,n=e-g;l.css("height",n).addClass("_item-loaded"),l.first().css("height",t)}function $(){var e="-48px";T>=L&&(e="-="+C+"px"),h.css({marginTop:e})}function J(){var e=u.scrollTop(),t=e-N;return N=e,t}function K(){var e=u.width(),t=p.find("img").offset().top-p.offset().top;if(H>0)_=c.offset().top-g+20;else{var n=0,r=d.height();d.length>0&&(n=d.offset().top-10),r===null&&(r=0),_=r-p.find("img").height()+n-t,_<0&&(_=c.offset().top+c.height()-p.find("img").height()+n-t)}e>=1600&&(_-=100)}function Q(){P=setTimeout(function(){var t=e("._active-slide",f),n=t.height(),r=n/2,i=u.scrollTop();if(!t.is(p))if(i!==0||t.index()!==0){var s=t.index(),o=i-n*s;o<=r?h.find("a").eq(s).trigger("click"):o<=n&&h.find("a").eq(s+1).trigger("click")}},1200)}function G(){clearTimeout(P)}function Y(){var e=p.width()+"px";T>=D+2?M===!1&&T<=_?(M=!0,p.css({position:"fixed",top:g+"px",width:e})):M===!0&&T>=_&&(M=!1,p.css({position:"absolute",top:_-g-38+"px",width:e})):Z()}function Z(){p.css({position:"relative",top:0}),M=!1}function et(){T>=E?(e(".zoom-in").addClass("zoom-ico-off"),v.addClass("_static").css({top:E+"px"})):(e(".zoom-in").removeClass("zoom-ico-off"),v.removeClass("_static").removeAttr("style"))}function tt(){U(),G(),e(".purchase-column, .carousel-vertical-inner, "+r).removeAttr("style"),t.is("small")?(e(r+", "+r+" .item").css({height:"auto",overflow:"visible",width:"auto"}),h.removeAttr("style"),a.removeClass("product-detail-page"),Z()):setTimeout(function(){I(),R(),W(),j||et()},400)}var r=".product-detail-carousel",i=".carousel-pagination",s=120,o=80,u=e(window),a=e("body"),f=e(r),l=e(".item",f),c=e(".detail-accordion"),h=e(i,f),p=l.last(),d=e(".product-related-column"),v=e(".product-detail-purchase"),m=e(".carousel-vertical-inner"),g=0,y=[],b=[],w=null,E=0,S=0,x=r+" "+i+" .carousel-pagination-link",T=u.scrollTop()+g,N=u.scrollTop(),C=0,k=0,L=0,A=0,O=0,M=!1,_=0,D=0,P=null,H=e(".exclusive-product").length,B=navigator.userAgent.toLowerCase(),j=/(ipad).* os 7_/.test(B),F=e("html").hasClass("iOS");return{load:function(){t.is("small")?f.css({height:"auto",overflow:"visible"}):(I(),q()),t.change(tt)}}});
