define(["jquery","configVariables"],function(e,t){function l(e,t){this.$form=e,this.fieldErrorFormat=t||"inline",this.preventSubmit=!1,this.bindEvents()}function c(e,t){return new l(e,t)}var n=".error-message",r="error-text",i="error-text-no-ajax",s="tooltip-help",o="tooltip-help-no-ajax",u="tooltip-message error-text",a="error",f=Modernizr.touch;return l.prototype.bindEvents=function(){this.$form.on("submit",e.proxy(this.submitHandler,this))},l.prototype.submitHandler=function(e){var n;if(this.preventSubmit)return;this.$form.find('input[required="required"]').length>0&&(e.preventDefault(),this.$form.find("input.input-login-email").length>0||this.$form.find("input.input-login-pwd").length>0?n=t.userMessages.loginError:n=t.userMessages.required,this.findRequiredField(n));if(this.$form.find(".error").length>0)return;this.$form.find("input[data-validation-match]").length>0&&(e.preventDefault(),n=t.userMessages.match,this.findMatchField(n)),this.$form.find(".error").length===0&&(this.preventSubmit=!0,this.formSuccess())},l.prototype.findRequiredField=function(t){var n=this,i=this.$form;i.find('input[required="required"]').each(function(){var i=e(this),o;i.removeClass(a),i.next("."+r).remove(),i.next("."+s).remove(),e.trim(i.val())===""&&(o=n.getFieldErrorMessage(i,t),n.appendFieldErrorMessage(i,o,t))})},l.prototype.findMatchField=function(t){var n=this,i=this.$form,o,u;i.find("input[data-validation-match]").each(function(){o=e(this),o.removeClass(a),o.next("."+r).remove(),o.next("."+s).remove(),o.val()!==e('input[name="'+o.data("validation-match")+'"]').val()&&(u=n.getFieldErrorMessage(o,t),n.appendFieldErrorMessage(o,u,t))})},l.prototype.appendFieldErrorMessage=function(e,t,n){var r;if(e.is("select"))f?(e.addClass(a),this.addErrorMessage(e,t,n)):(r=e.parents(".selectricWrapper"),r.find(".selectric").addClass(a),this.addErrorMessage(e,t,n));else if(e.is("input")||e.is("textarea"))e.addClass(a),this.addErrorMessage(e,t,n)},l.prototype.addErrorMessage=function(e,t,n){this.findErrorMessage()?e.after(t):this.putErrorMessage(n)},l.prototype.findErrorMessage=function(){return this.$form.find(n).length===0},l.prototype.getFieldErrorMessage=function(e,t){var n;switch(this.fieldErrorFormat){case"tooltip":n=this.getFieldErrorMessageTooltip(e,t);break;case"inline":n=this.getFieldErrorMessageInline(e,t);break;default:n=this.getFieldErrorMessageInline(e,t)}return n},l.prototype.getFieldErrorMessageInline=function(t,s){return e("<span>").addClass(r+" "+i+" "+n).html(s)},l.prototype.getFieldErrorMessageTooltip=function(t,r){var i=e("<div>"),a=e("<div>");return i.addClass(s+" "+o+" "+n),a.addClass(u),a.html(r),i.append(a),i},l.prototype.putErrorMessage=function(e){var t=this.$form;t.find(n).html(e)},l.prototype.formSuccess=function(){this.$form.submit()},{newFormValidate:c}});
