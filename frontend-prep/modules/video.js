define(["jquery","os","overlay"],function(e,t,n){function w(e,t){return t.indexOf(e)>-1}function S(){var t=this,n=e(t),r=w(this,g);r||(n.prop("muted",!0),g.push(t),n.addClass("bgVideoActive"),e(m).addClass("active"))}function x(){var t=this,n=e(t),r=w(this,g);r||(n.prop("muted",!0),g.push(t))}function T(){var t=e(this),n=t.find(h);t.addClass("_hover"),n.length&&(n.prop("muted",!0),n[0].play())}function N(){var t=e(this),n=t.find(h);t.removeClass("_hover"),n.length&&(n.prop("muted",!0),setTimeout(function(){n[0].pause()},400))}function C(){var t=e(this),n=t.find(".tooltip-on"),r=t.find(".tooltip-off");n.toggleClass("active"),r.toggleClass("active");var i=t.parent().find(".bgVideoActive");i.prop("muted",!i.prop("muted"))}function k(t){if(typeof t!="undefined"){typeof jQuery=="function"&&t instanceof jQuery&&(t=t[0]);var n=e(y).height();if(typeof t!="undefined"){var r=t.getBoundingClientRect();return r.top>=n&&r.top<=(window.innerHeight||document.documentElement.clientHeight)||r.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&r.bottom>=n||r.top<=n&&r.bottom>=(window.innerHeight||document.documentElement.clientHeight)}}}function L(e,t){var n;return function(){var r=k(e);r!=n&&(n=r,typeof t=="function"&&t())}}function A(t){var n=e(t),r=String(n.data("video-bg-id")),i={command:"find_video_by_id",media_delivery:"http",token:b,video_id:r,video_fields:"renditions,IOSRenditions"},s="https://api.brightcove.com/services/library?callback=?";e.getJSON(s,i,function(n){if(typeof n!="undefined"&&typeof n.renditions!="undefined"){var r=0;for(var i=0;i<n.renditions.length;i++)r=n.renditions[i].encodingRate>n.renditions[r].encodingRate&&n.renditions[i].frameWidth<1920?i:r;var s=n.renditions[r].url;e(t).attr("src",s)}})}function O(t){var n=e(t).attr("loop"),r=e(t).data("video-bg-loop")?parseInt(e(t).data("video-bg-loop"),10):0,i=e(t).data("video-bg-executed-loops")?parseInt(e(t).data("video-bg-executed-loops"),10):0,s=e(t).data("video-bg-id"),o=e('.volume[data-volume-id="'+s+'"]');!n&&r&&i<r?(i++,e(t).data("video-bg-executed-loops",i),t.play()):(e(t).removeClass("bgVideoActive"),e(t).remove(),o.removeClass("active"),o.remove())}function M(){function L(e){var t=e.parents(".vignette-video-overlay");t.length&&setTimeout(function(){var e=t.find(".video-inline-parent").height();t.find(".vignette-wrapper").height(e)},0)}function M(t){var n=t.$video.parents(".video-inline-parent"),s=n.find(".video-actions"),o=e(".spinner-video-wrapper"),u=n.parents(".video-parent").find("[data-video-bg-id]"),f=n.parents(".video-parent").find(".volume");t.$playButton.removeClass(r),t.$playButton.on("click",function(){s.show(),u&&u.length&&!u.parents(".the-edit-article-component").length?(u.remove(),f.remove()):u.parents(".the-edit-article-component").length&&e("video").each(function(){e(this).addClass("paused"),this.pause()}),t.video.play(),window.navigator.platform!=="iPhone"&&window.navigator.platform!=="iPod Touch"&&window.navigator.platform!=="iPad"?(n.addClass("active"),L(t.$video)):window.navigator.platform!=="iPad"&&(o.addClass("active"),setTimeout(function(){o.removeClass("active")},4e3)),window.navigator.platform!=="iPhone"&&window.navigator.platform!=="iPod Touch"&&i&&(t.videoNode.requestFullscreen?t.videoNode.requestFullscreen():t.videoNode.webkitRequestFullscreen?t.videoNode.webkitRequestFullscreen():t.videoNode.mozRequestFullScreen?t.videoNode.mozRequestFullScreen():t.videoNode.msRequestFullscreen?t.videoNode.msRequestFullscreen():t.videoNode.webkitSupportsFullscreen&&t.videoNode.webkitEnterFullscreen(),n.css("visibility","visible")),a&&n.css("display","block")}),e(".video-container .play").on("click",function(){var t=e(this),n=e(t.attr("href"));n.get(0).paused==1?(n.get(0).play(),t.html("Pause")):(n.get(0).pause(),t.html("Play")),t.toggleClass("play-white").toggleClass("pause-white")})}function D(t){var i=t.$video.parents(".video-inline-parent"),s=i.find(".video-close"),o=i.find(".video-actions");t.$playButton.removeClass(r),s.on("click",function(){t.video.pause(),o.hide(),i.removeClass("active");if(i.parents(".overlay").length){var r=i.parents(".overlay"),s=r.attr("id");n.close("#"+s)}a&&e(this).closest(".video-inline.video-inline-parent").css({display:"none"})})}function P(e){var t=document.getElementsByTagName("video"),n=null;for(var r=0;r<t.length;r++)t[r]&&t[r].getAttribute("data-video-id")==e&&(n=t[r]);return n}function H(t){if(!s){var n=document.getElementById(t.videoId);e(".video-actions .video-share").on("click",function(n){n.preventDefault();var r=e(this).attr("href");t.video.pause(),e(r).parent().addClass("_show-share-video")}),e(".social-overlay-inline-close").on("click",function(t){t.preventDefault(),e("._show-share-video").removeClass("_show-share-video")}),n.onended=function(){var t=e(".video-actions .video-share").attr("href");e(t).parent().addClass("_show-share-video")}}}t.isMobileDevice();var d=e(l),g=e(v),y=e(c),b=e(h),w=e(p),E=e(".edit-has-video").find(".agenda-media-wrapper");i=e("html").hasClass("mobile")||e("html").hasClass("tablet")?!0:!1,s=e("html").hasClass("mobile")&&!e("html").hasClass("tablet")?!0:!1,a=navigator.userAgent.match(/(iPad|iPhone|iPod touch);.*CPU.*OS 7_\d/i),f=navigator.userAgent.match(/(iPad|iPhone|iPod touch);.*CPU.*OS 8_\d/i),u=navigator.userAgent.match(/iPad/i)!=null,o=s&&(window.navigator.platform=="iPhone"||window.navigator.platform=="iPod Touch"),i?(g.remove(),d.remove()):(y.on("timeupdate",S),b.on("timeupdate",function(){e(this).addClass("video-ready")}),w.on("timeupdate",x),E.on("mouseenter",T),E.on("mouseleave",N),e(m).on("click",C),e(window).on("DOMContentLoaded load resize scroll",function(){y.each(function(){e(this).on("ended",function(e){O(e.target)});var t=e(this).parents(".video-parent");k(t)&&!e(this).hasClass("paused")?this.play():this.pause()}),w.each(function(){var t=e(this).parents(".scroll-background-video-container");k(e(this))&&!e(this).hasClass("paused")?(t.addClass("scroll-video-active"),this.play()):(t.removeClass("scroll-video-active"),this.pause())})}),d.each(function(){A(this)})),e("[data-video-id]").each(function(){var t=e(this).attr("id"),n=e(this).data("video-id"),s=videojs(t),o=e("#"+t),a=P(n),f=o.parents(".video-parent").find(".play"),l,c,h,p={videoId:t,video:s,videoNode:a,$video:o,$playButton:f};s.ready(function(){l=o.parents(".video-inline-parent"),c=l.find(".video-close"),h=l.find(".video-actions"),f.removeClass(r),M(p),D(p)}),i&&(e(document).bind("webkitfullscreenchange.videocomponent mozfullscreenchange.videocomponent fullscreenchange.videocomponent MSFullscreenChange.videocomponent",function(){_(p)}),u&&e('video[data-video-id="'+n+'"]').bind("webkitendfullscreen",function(){_(p)}))})}function _(e){if(!document.fullscreenElement&&!document.mozFullScreenElement&&!document.webkitFullscreenElement&&!document.msFullscreenElement||f){e.$video.addClass(r);var t=e.$video.parents(".video-inline-parent"),n=t.find(".video-close");e.$video.parents(".video-overlay-content").length==0&&n.click(),!("standalone"in window.navigator)&&window.navigator.platform!=="iPhone"&&e.video.pause()}}var r="_disabled",i,s,o,u,a,f,l=".bg-video",c=".header-background-video",h=".hover-background-video",p=".scroll-background-video",d="edit-has-video",v=".loop-opacity-layer",m=".volume",g=[],y="#header-main",b="KT54ojO-CmN3o3bN5rrgiq6aphtHAZl9hmRTdVawju8lQ6YFjgqJpw..",E=function(e,t,n){var r;return function(){function u(){n||e.apply(s,o),r=null}var s=this,o=arguments;r?clearTimeout(r):n&&e.apply(s,o),r=setTimeout(u,t||100)}};return{load:function(){M()}}});
