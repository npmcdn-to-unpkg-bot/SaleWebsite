define(["jquery","googleMaps","googleMapsApi","breakpoints","viewport","handlebars","ajaxConfig","os"],function(e,t,n,r,i,s,o,u){function V(){var e=X-N,n=p-v-g-y;e===0&&(e=X,n=n/2-50),S.height(n).width(e),A&&t.redraw(A,{width:e,height:n})}function $(){var t,n=e(document).scrollTop();r.is("small")||(t=e(document).height()-(m+y)-S.height(),n>t-v-g?w.css({position:"absolute",bottom:y}):w.removeAttr("style"))}function J(){var t=e(".content");e(window).resize(function(){p=e(window).height(),d=e(window).width(),v=e("#header-main").height(),m=e("#footer-main").height(),g=parseFloat(t.css("padding-top"),10),y=parseFloat(t.css("padding-bottom"),10),X=b.width(),E=w.offset(),x=S.height(),N=T.width(),V()}),e(window).scroll(function(){(r.is("standard")||r.is("medium"))&&$(),h=e(document).scrollTop(),E=w.offset()})}function K(){var e=1e3;return z&&(e=300),e}function Q(){var t=f;t.delegate(".store-details-cta","click",function(n){n.preventDefault(),dt(this);var r=e(this),s=r.parent(".store-locator-card");r.hasClass("store-details-expanded")||t.find(".store-details-expanded").removeClass("store-details-expanded"),G(s);var o=s.data("id");i.scrollToManualOffsetAdded(".location-"+o,"#header-main",K(),function(){},10)})}function G(t){var n=t.children(".store-details-section"),r=t.children(".store-details-cta");t.data("id")==C?(t.addClass("store-locator-card-active"),r.addClass("store-details-expanded"),n.slideDown(400)):(t.removeClass("store-locator-card-active"),r.removeClass("store-details-expanded"),n.slideUp(400)),e(".store-locator-card",a).not(t).children(".store-details-section",a).hide(),e(".store-locator-card",a).not(t).removeClass("store-locator-card-active")}function Y(e,t,n,r){e.metadata={type:"point",id:t,name:r,active:!1},L[t]=e,ht(e)}function Z(){}function et(t){var n=0,r=0,i=t.length,s={};return e(t).each(function(){n+=parseFloat(e(this).data("latitude")),r+=parseFloat(e(this).data("longitude"))}),s.latitude=n/i,s.longitude=r/i,s}function tt(e){t.setCenter(A,e)}function nt(t,r,i,s){var o=new n.LatLng(r,i),u=google.maps.geometry.spherical.computeDistanceBetween(o,s)/parseInt(S.data("map-convert-unit"),10),a=parseFloat(u).toFixed(1);W&&e(".store-distance",t).html(a+"<br/>"+S.data("map-unit"))}function rt(){var r=e(".store-locator-cards",a),i=s.compile(B),o=GUCCI.storeLocatorDefault,u=o.latitude,f=o.longitude,l=u+","+f,c=o.number,h=new n.LatLng(u,f),p;r.append(i(o)),p=e(".store-locator-card",a),A=t.buildMap("store-locator-map",h),t.createMarker(l,c,A,F,Y,Z),t.zoomToFitMarkers(p,A),st()}function it(){L={};var r=e(".store-locator-card",f);if(r.length===0)rt();else{var i=et(r),s=new n.LatLng(i.latitude,i.longitude);A=t.buildMap("store-locator-map",s),t.zoomToFitMarkers(r,A),r.each(function(){var n=e(this).data("latitude"),r=e(this).data("longitude"),i=e(this).data("id"),s=i+10,o=n+","+r;e(".store-distance",this).html(e(this).data("distance")),t.createMarker(o,i,A,F,Y,Z,s)}),st()}}function st(){ut(),t.setControls(A),e(".map-column-zoom-in",a).show(),e(".map-column-zoom-out",a).show(),ot();var n=ct();yt(n),j.html(e(".store-locator-card:visible",a).length)}function ot(){e(".map-column-zoom-in",a).on("click",function(){if(A===undefined)return;var e=t.getZoom(A);t.setZoom(A,e+1)}),e(".map-column-zoom-out",a).on("click",function(){if(A===undefined)return;var e=t.getZoom(A);t.setZoom(A,e-1)})}function ut(){t.addListener(A,"zoom_changed",function(){e("#store-locator-map").attr("data-zoom")=="true"&&bt(t.getBounds(A),!1,!0)}),t.addListener(A,"dragstart",function(){_.hide(),D.hide()}),t.addListener(A,"dragend",function(){_.show(),D.show(),bt(t.getBounds(A),!1,!0)})}function at(){var t,n;U===!1&&(f.delegate("div.store-locator-card","mouseover",function(){t=e(this).data("id"),n=L[parseInt(t,10)],ft("over",n),e(".map-google-label-id-"+t).css({"z-index":200}).addClass("_hover")}),f.delegate("div.store-locator-card","mouseout",function(){t=e(this).data("id"),n=L[parseInt(t,10)],C==n.metadata.id?ft("active",n):ft("normal",n)}))}function ft(e,n){var r=F;e=="over"?r=I:e=="active"?r=q:e=="normal"&&(r=F),t.updateMarker(n,e,r)}function lt(){e(".filter-container").on("touchmove",function(e){e.stopPropagation(),M=!0}),e(".filter-container-row").on("click touchend",function(t){t.stopPropagation(),t.preventDefault();if(M===!0){M=!1;return}e(this).toggleClass("active"),e(this).find("input").attr("checked","checked");var n=ct(),r="";n.length>0?(e(".sro-reset-filters-button",a).show(),r="("+n.length+")"):(e(".sro-reset-filters-button",a).hide(),r=""),e(".sro-filter-selected-number").html(" "+r),yt(n)})}function ct(){var t=[];return e(".filter-container-row").each(function(){e(this).hasClass("active")&&t.push(e(this).attr("data-value"))}),t}function ht(n){t.addListener(n,"click",function(){e.each(L,function(){this.metadata.active=!1,ft("normal",this)}),n.metadata.id!=C?(ft("active",n),n.metadata.active=!0,C=n.metadata.id):(ft("normal",n),C=0),Nt(n,!0,!0)}),U===!1&&(t.addListener(n,"mouseover",function(){pt(n),n.setZIndex(100)}),t.addListener(n,"mouseout",function(){n.setZIndex(1),n.metadata.id!=C&&ft("normal",n),O=0,Tt(!1)}))}function pt(e){O=e.metadata.id,e.metadata.id!=C&&(ft("over",e),Tt(e)),setTimeout(function(){if(e.metadata.active===!0)return;if(O!=e.metadata.id)return;Nt(e,!1)},k)}function dt(t){var n=e(t).parent(),r=e(n).data("id");e.each(L,function(){this.metadata.active=!1,ft("normal",this)});var i=L[parseInt(r,10)];i.metadata.id==C?(ft("normal",i),C=0):(ft("active",i),C=i.metadata.id)}function vt(){e.each(L,function(){t.removeMarker(this,null)}),L={}}function mt(e,t){L!==undefined&&typeof L[e]!="undefined"&&L[e].setVisible(t)}function gt(){e(":checkbox",a).each(function(){e(this).off("change"),e(this).parents(".filter-container-row").removeClass("active"),e(this).attr("checked",!1),e(this).on("change")}),yt([]),e(".sro-filter-selected-number",a).html("")}function yt(t){var n=e(".store-locator-card",a);t.length>0?l.addClass("filter-applied"):l.removeClass("filter-applied"),e(n).each(function(){var n=0;while(n<t.length&&n!=-1){var r=e(".store-products-list-item",this).filter('[data-filter-id="'+t[n]+'"]');r.length===0?(mt(e(this).data("id"),!1),e(this).hide(),n=-1):n++}n!=-1&&(mt(e(this).data("id"),!0),e(this).show())}),j.html(e(".store-locator-card:visible",a).length)}function bt(r,o,u,l){var c=f,h=s.compile(B),p,d,v,m,g,y,b,w,E,S=[];if(r instanceof google.maps.LatLngBounds){var x=A.zoom,T=new google.maps.LatLng(-78.067277353927,169.290755),N=new google.maps.LatLng(86.6557423635765,-33.209245),C=new google.maps.LatLngBounds(T,N),k=new google.maps.LatLng(14,-172),L=new google.maps.LatLng(50,-50);x==3&&C.equals(r)&&(r=new google.maps.LatLngBounds(k,L))}i.scrollTo("#header-main"),u===!0?e(".search-bar-input",a).val(""):e(".search-bar-input",a).val(r),d=P,e(".filter-container .filter-container-row.active").find("input").each(function(){S.push(e(this).val())}),e("#store-locator-context").data("variation")=="no-data"&&(d=H),E="&searchData="+r,E=E+"&filters="+S,l&&(v=o.lat(),m=o.lng(),E=E+"&latitude="+v+"&longitude="+m);var O=e.ajax({url:d,type:"GET",data:E,dataType:"json"});O.done(function(r){vt(),e("#store-locator-map",a).show(),r.stores&&r.stores.length>0?(p=e(".store-locator-card",f),c.empty(),Ct(!1),j.html(r.stores.length),w=et(p),y=new n.LatLng(w.latitude,w.longitude),e(r.stores).each(function(){c.append(h(this)),v=this.latitude,m=this.longitude,g=this.number,b=v+","+m,t.createMarker(b,g,A,F,Y,Z),e(".store-distance",e(".location-"+g)).html(this.distance),Mt(this)}),p=e(".store-locator-card",f),w=et(p),y=new n.LatLng(w.latitude,w.longitude),u!==!0&&(tt(y),t.zoomToFitMarkers(p,A)),S&&S.length&&e.each(S,function(t,n){e("#"+n).closest(".filter-container-row").trigger("click")}),e(window).trigger("resize"),wt(r.stores)):(J(),o!==!1&&tt(o),Ct(!0),e(".no-results p",a).remove()),r.suggestions&&r.suggestions.length!==0&&Et(r.suggestions),At(),r.filters&&r.filters.length&&e.each(r.filters,function(t,n){e("#"+n).closest(".filter-container-row").trigger("click")})})}function wt(t){var n=[],r={};e(t).each(function(){r.name=this.name,r.country=this.address.country,r.city=this.address.city,n.push(r)});var i={};i.stores=n,dataLayer.push(i)}function Et(t){e.each(t,function(){var t=e('<p class="no-results-title-sugestion">'+(this.url?'<a href="'+hybris.contextPath+this.url+'">'+this.name+"</a>":this.name)+"</p>");t.on("click",function(){bt(e(this).html())}),e(".no-results",a).append(t)}),e(window).trigger("resize")}function St(e,t){var r=new google.maps.Geocoder,i=new n.LatLng(e,t);r.geocode({latLng:i},function(e,t){if(t==google.maps.GeocoderStatus.OK&&e[1]){var n=e[1].address_components[0];bt(n.long_name,i,!1,!0)}})}function xt(){var t=!navigator.geolocation;t||e(".search-bar-use-my-current-location",a).on("click touchstart",function(){var t=e(this);navigator.geolocation.getCurrentPosition(function(e){W=!0,w.removeClass("no-geo"),St(e.coords.latitude,e.coords.longitude)},function(){var n=r.is("small")&&typeof t.data("error-remove-mobile")!="undefined",i=typeof t.data("error-append")!="undefined";if(!i)e(t.data("error-container")).show();else{var s=e(t.data("error-container")).find("p").html(),o=e('<li class="checkout-error-message empty-fields geolocation">').html(s),u=e(".checkout-error-messages");u.find(".geolocation").remove(),u.append(o)}n&&e(".search-bar-use-my-current-location",a).remove()})}),t&&e(".search-bar-use-my-current-location",a).remove()}function Tt(t){var n=e(".store-locator-card",a);e(n).each(function(){e(this).data("id")!=C&&e(this).removeClass("store-locator-card-active")});if(t===!1)return;var r=t.metadata.id,i=e(".location-"+r,a);i.addClass("store-locator-card-active")}function Nt(t,n){var r=t.metadata.id,s=e(".location-"+r,a);n===!0&&G(s),i.scrollToManualOffsetAdded(".location-"+r,"#header-main",K(),function(){},10)}function Ct(t){t===!0?(e(".no-results",a).show(),e(".search-result-options",a).hide(),e(".sro-search-result",a).hide(),f.hide()):(e(".no-results").hide(),e(".search-result-options",a).show(),e(".sro-search-result").show(),f.show())}function kt(){e(".search-bar-input",a).keypress(function(t){var n=t.keyCode?t.keyCode:t.which;n=="13"&&(W=!1,bt(e(this).val(),!1))}),e(".search-bar-input-submit",a).on("click touchstart",function(){var t=e(".search-bar-input",a).val();W=!1,bt(t,!1)}),e(".search-bar-input",a).on("click touchstart",function(){e(this).val("")})}function Lt(){(e("html").hasClass("mobile")===!0||e("html").hasClass("tablet")===!0)&&e(".sro-filter-button, .sro-filter-button-bottom",a).on("touchend",function(t){if(l.hasClass("filter-clicked")){r.is("small")&&c.hide(),l.removeClass("filter-clicked"),e(".filter-container",a).hide();if(r.is("small")||r.is("medium"))e(".sro-filter-row-title",a).hide(),e(".sro-number-of-results",a).show(),e(".button-label.filter-label",l).removeClass("hide"),e(".button-label.done-label",l).addClass("hide"),r.is("small")&&e(".sro-reset-filters-button").hide()}else l.addClass("filter-clicked"),e(".filter-container input:checked",a).length>0&&c.show(),e(".filter-container",a).show(),(r.is("small")||r.is("medium"))&&e(".button-email",a).hide(),r.is("small")&&(e(".sro-filter-row-title",a).show(),e(".sro-number-of-results",a).hide(),e(".button-label.done-label",l).removeClass("hide"),e(".button-label.filter-label",l).addClass("hide"));if(e(t.currentTarget).parents(".filter-container").length>0)return}),e(".sro-reset-filters-button, .sro-reset-filters-button-bottom",a).on("touchend click",function(){gt(),c.hide(),e(".user-actions",a).show()})}function At(){var t=e("#store-locator-context .sro-filter-button");t[e(".filter-container-row",t).length===0?"hide":"show"]()}function Ot(e){var t='<div class="filter-container-row">';return t+='<label for="'+e.filterId+'" class="filter-container-label">',t+=e.name,t+="</label>",t+='<input type="checkbox" name="'+e.filterName+'" id="'+e.filterId+'" value="'+e.filterName+'" class="filter-check">',t+='<i class="filter-container-ico-check"></i>',t+="</div>",t}function Mt(t){if(!t.storeProducts)return;var n=e("#store-locator-context .filter-container");e(t.storeProducts).each(function(){n.find("#"+this.filterId).length===0&&n.prepend(Ot(this))})}function _t(){e("#store-printer").on("click",function(t){t.preventDefault();var n="",r;e(".store-locator-card").each(function(){r=e(this),r.css("display")!="none"&&(n+=(n===""?"":",")+r.attr("data-store-code"))}),n!==""&&(window.location.href=e(this).attr("href")+n)})}function Dt(){u.isMobileDevice(),i.scrollTo("#header-main"),V(),J(),Q(),it(),at(),lt(),xt(),kt(),Lt(),At(),_t()}function Pt(){it(),at(),lt(),xt(),Lt()}var a=e("#store-locator-context"),f=e(".store-locator-cards",a),l=e(".sro-filter-button",a),c=e(".sro-reset-filters-button",a),h=e(document).scrollTop(),p=e(window).height(),d=e(window).height(),v=e("#header-main").height(),m=e("#footer-main").height(),g=parseFloat(e(".content").css("padding-top"),10),y=parseFloat(e(".content").css("padding-bottom"),10),b=e(".store-locator",a),w=e(".map-column-container",a),E=w.offset(),S=e("#store-locator-map",a),x=S.height(),T=e(".search-column",a),N=T.width(),C,k=2e3,L={},A,O=0,M=!1,_=e(".map-column-zoom-in",a),D=e(".map-column-zoom-out",a),P=o.config()["STORE-LOCATOR-DATA-RESPONSE"],H=o.config()["STORE-LOCATOR-EMPTY-RESPONSE"],B=e("#store-locator-card-template").html(),j=e(".sro-number-of-results .number",a),F="/_ui/responsive/theme-gucci/images/map-marker-normal.png",I="/_ui/responsive/theme-gucci/images/map-marker-hover.png",q="/_ui/responsive/theme-gucci/images/map-marker-active.png";e("html").hasClass("retina")&&(F="/_ui/responsive/theme-gucci/images/map-marker-normal-2x.png",I="/_ui/responsive/theme-gucci/images/map-marker-hover-2x.png",q="/_ui/responsive/theme-gucci/images/map-marker-active-2x.png");var R=!1,U=e("html").hasClass("touch"),z=!e("html").hasClass("gt-ie9"),W=!1;U||e("body").css("overflow","auto");var X=b.width();return e("body").on("load-more-success",Pt),{load:Dt}});
