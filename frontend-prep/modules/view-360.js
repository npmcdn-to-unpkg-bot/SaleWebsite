define(["jquery","os","breakpoints","reel","overlay","slick"],function(e,t,n,r,i){function y(e){var t,n=1,r=e.data("initial-frame");if(-1!==["rotated","rotating"].indexOf(e.data("rotate-phase")))return;e.data("rotate-phase","rotating"),t=window.setInterval(function(){e.trigger("stepLeft");if(r===n){window.clearInterval(t),e.attr("data-rotate-phase","rotated");return}n+=1},e.data("rotate-interval"))}function b(t,n){var r,i;switch(t){case"overlay":r=e(c).has(n),i=e(h,r),e(a,i).append(n.parent()),e(f,r).show(),e(l,r).show();break;case"inline":r=e(c).has(n),i=e(h,n),r.append(n.parent()),e(f,r).hide(),e(l,r).hide(),i.hide()}}function w(){var t=e(".view-360-image["+s+"]");!0===n.is("small")?t.each(function(t,n){b("overlay",e(n))}):(t.each(function(t,n){b("inline",e(n))}),undefined!==m&&i.close("#"+m.attr("id")))}function E(e){var t,n;return e=e[0],!e||1!==e.nodeType?!1:(n=document.documentElement,t=e.getBoundingClientRect(),!!t&&t.bottom>=0&&t.right>=0&&t.top<=n.clientHeight&&t.left<=n.clientWidth)}function S(){for(var e in v)if(n.is(e))return e;return""}function x(e){var t=e.attr(s),r=o+S();return n.is("retina")&&(t=e.attr(r)||t,r+=u),e.attr(r)||t}function T(){var t;t=e(".view-360-image["+s+"]"),e(window).on("scroll.view360",function(){t.each(function(){E(e(this),"above")&&y(e(this))})}),n.is("small")?N(t):setTimeout(function(){N(t)},200)}function N(t){t.each(function(){L(e(this))})}function C(){var t=e(this),n=t.closest(".carousel-inner.shop-the-look-inner, .carousel-vertical-inner");n.addClass("transform-disable"),n.slick("slickSetOption","draggable",!1),n.slick("slickSetOption","swipe",!1),e(this).closest(".product-detail-image-slide").addClass("view360-overlay-carousel");var r=e("img.view-360-image",t);E(r,"above")&&y(r)}function k(){var t=e(this).closest(".carousel-inner.shop-the-look-inner, .carousel-vertical-inner");t.slick("slickSetOption","draggable",!0),t.slick("slickSetOption","swipe",!0)}function L(e){var t,n;t=e.data("initial-frame"),n=x(e),n=e.attr("src"),n=e.attr("src");var r=n.split("/");if(r&&r.length>0){var i=r[r.length-1],s=i.split("_");s[4]="0##";var o=s.join("_");n=n.replace(i,o)}try{e.reel({images:n,frames:e.data("frames"),frame:t,cw:e.data("cw"),cursor:e.data("cursor"),responsive:e.data("responsive"),concurrent_requests:10,velocity:e.data("velocity"),brake:e.data("brake"),footage:e.data("footage"),opening:e.data("opening"),entry:e.data("entry"),wheelable:!1}).trigger("stepRight"),E(e,"above")&&y(e)}catch(u){}}function A(){var t=e(".view-360-image["+s+"]");t.each(function(){e(this).unreel()})}function O(){g===!1&&(i.onOpen(function(e){!e.hasClass("view-360-overlay")&&!e.hasClass("style-selector-overlay")&&A()}),i.onClose(function(t){var n=e(".view-360-image["+s+"]");!t.hasClass("view-360-overlay")&&!t.hasClass("style-selector-overlay")&&!t.hasClass("cookie-overlay")&&n.each(function(){L(e(this))})}),g=!0)}var s="data-src",o=s+"_",u="_retina",a=".overlay-content",f=".view-360-image-overlay-static",l=".overlay-open img",c=".item.carousel-slide, .item.product-detail-image-slide",h=".view-360-overlay",p="#carousel-vertical",d=".item-shop-the-look-carousel",v={standard:!0,medium:!0,small:!0},m=e(".view-360-overlay"),g=!1;return{load:function(){r.lazy=!1,T(),O();if(e(p).length>0||e(d).length>0)n.change(function(){w()}),e(h).on("overlay.close",k).on("overlay.open",C).on("overlay.afterClose",function(){e(this).closest(".product-detail-image-slide").removeClass("view360-overlay-carousel")}),!0===n.is("small")&&w()},initComponents:T,unReelAllImg:A}});
