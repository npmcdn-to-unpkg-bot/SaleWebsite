define(["jquery","ajaxConfig","formEndpointValidation","overlay"],function(e,t,n,r){function u(){s=e(".add-to-shopping-bag-form"),a()}function a(){s.off(),s.each(function(t,r){e(r).data("formValidator",n.newInstance(e(r),l,c,"inline"))})}function f(){var e=s.closest(".stl-item-details"),t=e.find(".add-to-shopping-bag"),n=e.find(".added-to-shopping-bag-button");t.removeClass("prevent-more-submit"),t.hide(),n.addClass("show-added-button")}function l(t){t.status&&t.status==="ok"?(e(document).trigger("shopping-bag.add",t),f(),o=!0):t.status&&t.status==="maxOrderQuantityExceeded"?(e(document).trigger("shopping-bag.add",t),s.find(".selectricWrapper").removeClass("error")):s.find(".selectricWrapper").removeClass("error"),r.close("#saved-items-backorder-overlay"),t.field_error_messages&&t.field_error_messages.size?e(".shipping-info").hide():e(".shipping-info").show()}function c(t){var n=e(this.$form);e.each(t.field_error_messages,function(t,r){var i,o;r.length>0&&(i=n.data("formValidator").getFieldErrorMessage(t,r)),o=s.find('[name="'+t+'"]'),o.parents(".add-to-bag-size-selector,.sizes").find(".error-text").remove(),n.data("formValidator").appendFieldErrorMessage(o,i),t=="size"&&e(".noSizeDropDown").length>0?(e(".shipping-info").show(),e(".shipping-info").html('<span class="error-text" id="size-error">'+r+"</span>")):t=="size"&&r.length>0&&e(".shipping-info").hide()})}function h(){return o}var i=t.getRemoteService("SHOPPING-BAG-SAVE-ITEM-ENDPOINT"),s=null,o;return e(".add-to-shopping-bag").removeAttr("disabled"),{load:function(){u(),e(window).ready()&&e(".shopping-bag-cta.add-to-shopping-bag").show()},addToShoppingBag:function(e){s=e,s.prop("action",i),a()},successAdded:function(){return h()}}});
