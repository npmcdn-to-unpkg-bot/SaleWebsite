define(["jquery","overlay","ajaxConfig","handlebars","viewport","breakpoints","ajaxLoader","tweenMax","scrollTo","slick"],function(e,t,n,r,i,s,o){function Z(){var t=e(O);W=[];for(var n=0;n<=t.length;n++)W.push(t[n]);return W}function et(){W.forEach(function(t){e(t).find(H).removeClass(a).css({visibility:"hidden",opacity:0})})}function tt(){return X=undefined,W.forEach(function(t){e(t).hasClass(a)&&(X=e(t))}),X}function nt(t){return V=e(t).closest(O),V}function rt(t){switch(t){case"shipping":V=e(M);break;case"gifting":V=e(_);break;case"payment":V=e(D);break;case"place-order":V=undefined}return V}function it(t){var n;switch(t){case"shipping":n=e(M);break;case"gifting":n=e(_);break;case"payment":n=e(D);break;case"place-order":n=undefined}return n}function st(e){var t=!1;return e.hasClass("shipping-module")?t=K.shipping.status:e.hasClass("gifting-module")?t=!0:e.hasClass("payment-module")&&(t=K.payment.status),t}function ot(t){var n=e(X).find(H),r=e(X).find(B);n.length>0&&(t||TweenMax.to(window,E,{scrollTo:{y:0}}),TweenMax.to(X,.75,{height:"180px"}),X.css("overflow","hidden"),n.slideUp(b),TweenMax.to(n,y,{autoAlpha:0,onComplete:function(){n.hide(),r.show(),r.fadeIn("slow"),X.css("height","auto"),X.css("overflow",""),e(X).removeClass(a),st(e(X))&&e(X).addClass(l),t&&ht(.5)}}))}function ut(t){e("#selected-wrap").val(t),e(".selected-wrap-indicator").attr("data-wrap",t)}function at(){var t=e(this);J.each(function(){e(this).removeClass(k)}),t.addClass(k),ut(t.data("value"))}function ft(){var t=V.find(H),n=e(V).find(B);t.length>0&&(V.removeClass(f),V.removeClass(l),n.fadeOut("slow",function(){t.slideDown(w,function(){ct(V,y)}),TweenMax.to(t,1,{autoAlpha:1,onComplete:function(){V.addClass(a),n.slideUp(),e(".carousel-inner",e(".wraps-carousel")).slick("unslick"),tt().hasClass("gifting-module")&&e(".carousel-inner",e(".wraps-carousel")).slick("init")}})})),e(document).trigger("checkout.open",V.data("module"))}function lt(){V=e(M);var t=e(X).find(j);pt(t),ot(),ft()}function ct(t,n,r){var i,o;n=n||0;if(t.offset()===undefined)return;if(t.hasClass(d))i=0;else{var u=t.offset().top,a=e("header").outerHeight(!0);s.is("small")?o=Math.ceil(x/2):o=x,i=u-a-o}r!==undefined?TweenMax.to(window,S,{scrollTo:{y:i},delay:n,onComplete:r}):TweenMax.to(window,S,{scrollTo:{y:i},delay:n})}function ht(t){var n,r,i=e("."+g).offset().top,o=e("header").outerHeight(!0);t=t||0,s.is("small")?r=Math.ceil(T/2):r=T,n=i-o-r,TweenMax.to(window,S,{scrollTo:{y:n},delay:t})}function pt(e){TweenMax.to(e,1,{autoAlpha:0})}function dt(e){TweenMax.to(e,1,{autoAlpha:1})}function vt(t){Z(),rt(t),tt();var n=e(V).find(j),r=e(X).find(j);pt(n),ot(),ft(),dt(r),mt(!1)}function mt(e){e?(I.removeClass("inactive"),q.removeClass("inactive")):(I.addClass("inactive"),q.addClass("inactive"))}function gt(t){var n;Z(),tt(),ot(t),n=e(X).find(j),dt(n),K.payment.status&&K.shipping.status&&K.email.status&&mt(!0)}function yt(t){var n=e(this),r;t.preventDefault(),nt(n),tt(),r=e(X).find(j),pt(n),ot(),ft(),dt(r),mt(!1)}function bt(){if(I.hasClass("inactive"))return;var t=z.is(":checked");t?(e(".order-details-place-order .error-message").removeClass("active"),z.next().removeClass("error")):(e(".order-details-place-order .error-message").addClass("active"),z.next().addClass("error"))}function wt(t){var n=e("script#order-details-summary").html(),i=r.compile(n);for(var s in t){var o=t[s],u=$.find("."+o.style);if(u.length=1){var a=u.parent().clone().children().remove().end().text();a!==undefined&&(o.label=a.trim())}}var f=i({data:t});$.html(f)}function Et(){if(!z.is(":visible"))return;var t=z.is(":checked");t&&(e(".order-details-place-order .error-message").removeClass("active"),z.next().removeClass("error")),K.termsAcceptance={},K.termsAcceptance.status=t}function St(t){var n=e(".confirmation-tooltip");K.payment.status&&K.shipping.status&&K.email.status?(K.termsAcceptance.status?n.html(n.data("msg-ready")):n.html(n.data("msg-accept")),n.attr("style","left: "+ -(n.width()+74)+"px"),!s.is("small")&&!t&&n.fadeIn("fast",function(){setTimeout(function(){n.fadeOut(700)},4e3)}),mt(!0)):V!==undefined&&!I.hasClass("filled-out")&&mt(!1)}function xt(){F.bind("click touchmove",yt),U.on("click",function(e){e.preventDefault()}),e("html").hasClass("android")&&e("select",O).on("click.select-android",function(){var t=e(this);e("html").hasClass("mobile")?e("html, body").animate({scrollTop:t.parent().offset().top-(parseInt(e("header").css("height").replace("px",""),10)+35)},20):t.off("select.select-android")}),z.length&&I.on("click",bt),$.on("update-totals",function(t,n){wt(e(this),n)}),z.on("change",Et),K.termsAcceptance.status=z.is(":checked")}function Tt(t,n,r,i){var s=e(".confirmation-tooltip");t==="payment"&&n===!0&&(r.method==="paypal"?(q.show(),I.hide()):(q.hide(),I.show())),K[t]={},K[t].status=n,K[t].info=r,t!=="email"&&n?it(t).addClass(l):t!=="email"&&V.removeClass(l),St(i)}function Nt(e){rt(e),V.removeClass(f)}function Ct(e){rt(e),V.addClass(f)}function kt(e){rt(e),V.removeClass(f),V.addClass(l)}function Lt(){if(K.payment.status&&K.shipping.status&&K.email.status&&!I.hasClass("inactive")){if(!K.termsAcceptance.status)return e(".order-details-place-order .error-message").addClass("active"),z.addClass("error"),!1;I.addClass("inactive");var t,n=Ot({},""),r=e(".tab-links li.active a").attr("data-payment-method");return r==="credit-card"&&e("#new-credit-card").is(":checked")?(e(L).submit(),!0):(e("#place-order-form #parameters").html(""),Dt(e("#place-order-form #parameters"),"payment-method",r),Dt(e("#place-order-form #parameters"),"action","place-order"),e("#place-order-terms").length>0&&Dt(e("#place-order-form #parameters"),"place-order-terms",e("#place-order-terms").is(":checked")),r==="wire-transfer"||r==="bpay"?e(A).submit():r==="credit-card"&&(Dt(e("#place-order-form #parameters"),"radio-credit-card",e("input[name=payment-credit-card-id]:checked","#credit-card-order").val()),e(A).submit()),!0)}return!1}function At(){var t=z.is(":checked");return t?(e(".order-details-place-order .error-message").removeClass("active"),z.next().removeClass("error"),!0):(e(".order-details-place-order .error-message").addClass("active"),z.next().addClass("error"),!1)}function Ot(t,n){var r={},i;return r[n]=t,n!=="shipping"&&(i=e(M).data("shipping-data"),typeof i!="undefined"&&(r.shipping=i)),n!=="gifting"&&(i=e(_).data("gifting-data"),typeof i!="undefined"&&(r.gifting=i)),n!=="payment"&&(i=e(D).data("payment-data"),typeof i!="undefined"&&(r.payment=i)),n!=="emailAddress"&&(i=e(P).data("email-address-data"),typeof i!="undefined"&&(r.emailAddress=i)),r}function Mt(){var t=Y.width(),n=e(window).width()/2,r=75,i=n-r;t>i&&(Y.addClass("double-line"),Y.css({width:i+"px","margin-top":"-6px"})),jt();var s;I.on("click",Lt),q.on("click",At),window.location.pathname.indexOf("paypal")===-1&&q.hide(),Z(),et(),s=e('input:radio[name = "address-radio"]:checked',"section"+M).val(),s===undefined||s==="new"||s==="near"?lt():e("section.payment-module").hasClass(c)&&(rt("payment"),vt("payment")),I.show(),R.removeClass("hide"),xt(),Ht(),Bt()}function _t(t){t!==undefined&&t.data!==undefined&&t.data.sopParameters!==undefined&&(e("#silentOrderPostForm .sop-parameters").html(""),jQuery.each(t.data.sopParameters,function(t,n){Dt(e("#silentOrderPostForm .sop-parameters"),t,n)}))}function Dt(e,t,n){e.append('<input type="hidden" name="'+t+'" value="'+n+'" />')}function Pt(e){e.redirectUrl!==undefined&&e.redirectUrl!==""&&e.redirectUrl!==null&&(window.location.href=hybris.contextPath+e.redirectUrl)}function Ht(){e(".checkout-error-messages li").length>0&&(rt("payment"),vt("payment"))}function Bt(){if(!e(M).hasClass("filled-out")){var t=e(D).find(j);pt(t)}}function jt(){e.ajax({url:Q+"?key="+(new Date).getTime(),type:"GET",dataType:"html"}).done(function(n){!n||(t.open("#"+G),e(window).load(function(){e("#"+G+":visible")&&e("body").addClass("overlay-lock")}),e(".merging-basket-overlay-wrapper").html(n),require(["addMergedProductShoppingBag"],function(e){e.bindEvents()}))}).fail(function(){})}var u="checkout-module",a="open-module",f="deactivated-module",l="filled-out",c="checkout-edit",h="checkout-select",p="edit-checkout-module",d="shipping-module",v="gifting-module",m="payment-module",g="order-details-place-order",y=.75,b=750,w=750,E=.75,S=.75,x=70,T=240,N="logged-in-info",C="CHECKOUT",k="selected",L="#silentOrderPostForm",A="#place-order-form",O="."+u,M="."+d,_="."+v,D="."+m,P="."+N,H="."+c,B="."+h,j="."+p,F=e(".button-transition"),I=e("#button-place-order"),q=e("#button-order-by-paypal"),R=e(".order-details-place-order"),U=e(".view-more"),z=e("#place-order-terms"),W=[],X,V,$=e(".order-details-totals"),J=e(".wrapping-options-list").find(".slick-slide"),K={email:{status:!1},shipping:{status:!1},gifting:{status:!1},payment:{status:!1},termsAcceptance:{status:!0}},Q=n.getRemoteService("UPDATE_CART_MERGE_ENTRIES"),G="merging-basket-overlay",Y=e(".small-view");return{copySopParameters:function(e){_t(e)},redirectThePageIfRequired:function(e){Pt(e)},scrollToModule:function(e){ct(e,0)},load:Mt(),goTo:function(e){vt(e)},setModuleStatus:Tt,closeMe:gt,enableModule:Nt,disableModule:Ct,isModuleComplete:st,collectAllValues:Ot,fillIconModule:kt,updateOrderDetailsTotals:wt}});
