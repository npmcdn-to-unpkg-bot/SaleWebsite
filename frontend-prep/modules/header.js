define(["jquery","breakpoints","viewport","os"],function(e,t,n,r){function gt(){et.bind("click"+i,bt),tt.bind("click"+i,sn),e(document).on("DOMMouseScroll mousewheel",".prevent-document-scroll, .prevent-document-scroll-list",An).on("click",yt),Y.on("mouseenter"+i,w,on).on("mouseleave"+i,w,un),r.supportsTouch()&&(e(document).on("touchstart.prevent-document-scroll",".prevent-document-scroll",Mn),e(document).on("touchmove.prevent-document-scroll",".prevent-document-scroll",On)),Vt()}function yt(t){var n=e("#header-nav-bag-wrapper");!n.is(t.target)&&n.has(t.target).length===0&&wt(n,!0)}function bt(e){var n=G.hasClass(_),r=-G.scrollTop();tn();if(!n){Zt(rt);if(t.is("medium")||t.is("small"))Z.addClass(u),Z.css("top",r)}rn(e)}function wt(e,t){Et(e)&&St(e,"removeClass",t,!0)}function Et(e){return e.hasClass(x)}function St(e,t,n,r,i){var s=jt(e);xt(s,t,n,r),Ot(s,t,i),Kt(s,t,n),xt(s,t,n,r)}function xt(e,t,n,r){Tt(t,n)&&(Nt(e)&&G[t](_),G[t](M)),Ct(e,t,n)&&G[t](D),r&&G[t](P)}function Tt(e,n){return e=="addClass"||n||t.is("standard")}function Nt(e){return nt.is(e)||nt.find(e).length}function Ct(e,n,r){return kt(e)&&n=="addClass"||Lt()&&n=="removeClass"||r||t.is("standard")}function kt(e){return At(e).length}function Lt(){return rt.hasClass(T)}function At(e){return jt(e).parents(m).first()}function Ot(t,n,r){var i=_t(t);Ht(t)[n](S)[n](x)[n](T),Mt(r,i)?(Y.addClass(q),i.focus()):(Y.removeClass(q),i.blur()),e(k).each(Jt)}function Mt(e,t){return e&&t.length&&!t.is(":focus")}function _t(e){var t=Dt(e),n=Pt(t);return Pt(e).not(n)}function Dt(e){return e.find(d)}function Pt(e){return e.find(E)}function Ht(e){var t=Bt(e).first();return kt(t)?qt(t):t}function Bt(e){var t=e.hasClass(v);return t?e:jt(e).find(m)}function jt(e){var t=e.hasClass(p),n=t?e:e.parents(d).first();return Ft(n)}function Ft(e){var t=e.attr(a);return t?It(t):e}function It(e){return rt.find("["+a+"="+e+"]")}function qt(t){var n=Rt(t),r=t.add(n),i=t.attr("id");return $.indexOf(i)!==-1||t.hasClass(J)?ht.addClass(R):ht.removeClass(R),"header-nav-favorites"===i&&e("#header-nav-favorites.header-nav-child-favorites").parent(".header-nav-drawer").addClass(U),r}function Rt(e){var t=e.attr(o);return t?Ut(t):zt(e,++z)}function Ut(e){return nt.find("["+o+"="+e+"]")}function zt(t,n){var r=it.clone(),i=e(),s,u,f;Wt(t,n),s=t.clone(),r.html(s).attr(o,n),nt.append(r),f=e("#header-nav-child-main");var l=f.find(".second-row");return l.each(function(){var t=e(this).html(),n=e(this).parents("section"),r=n.find(".first-row");r.find(".header-nav-group-title").length<2&&!!r.attr(a)&&r.append(t)}),i=Ut(n),Xt(i),$t(i),i}function Wt(t,n){t.attr(o,n),Dt(t).each(function(){e(this).attr(a,++W)})}function Xt(e){var t=e.find(c);st=st.add(t),ft=ft.add(e).add(t),Vt()}function Vt(){Y.off("click"+i).on("click"+i,c+":not(.header-nav-parent-account-signin)",an)}function $t(e){e.height()}function Jt(){var t=e(this),n=t.scrollTop();ct.addClass(A),lt.addClass(L),n===0&&lt.removeClass(L),t.height()+n>=t.prop("scrollHeight")&&ct.removeClass(A)}function Kt(e,n,r){var i=Qt(e),s=Gt(e),o=G.hasClass(_),a=G.scrollTop(),f=-Z.position().top,l=f>0?f:a,c=r?"removeClass":Yt(n);e[n](x),i.length&&i[n](S)[n](x),s.length&&s[c](T),!o&&(t.is("medium")||t.is("small"))&&(Z.removeClass(u).removeAttr("style"),G.scrollTop(l))}function Qt(e){var t=Bt(e).find(c);return jt(e).find(c).not(t).first()}function Gt(e){return Ht(At(e))}function Yt(e){return e=="addClass"?"removeClass":"addClass"}function Zt(n,r){if(n.is(".disable-nav-group"))return;var i=en(),s=r===undefined?!0:r,o=e(n.context).attr("class")===undefined?"":e(n.context).attr("class");Et(n)||((t.is("standard")||!Nt(n))&&tn(),St(n,"addClass",!1,i,s),o.indexOf("header-nav-parent-search")>-1&&e.event.trigger("open_search")),clearTimeout(V)}function en(){return Y.find(h).hasClass(x)}function tn(){nn()&&e(d).each(function(){wt(e(this),!0)})}function nn(){return G.hasClass(M)}function rn(e){e&&e.preventDefault&&e.preventDefault()}function sn(e){var t=rt.find(m+"."+T);wt(jt(t)),rn(e)}function on(){var n=e();t.is("standard")&&(n=jt(e(this)),n.hasClass(x)&&clearTimeout(V),X=setTimeout(function(){Zt(n)},N))}function un(){clearTimeout(V),t.is("standard")&&(V=setTimeout(function(){tn()},C),clearTimeout(X))}function an(n){var r=e(this),i=jt(r);if(!fn(r,i))return;rn(n),(t.is("small")||t.is("medium"))&&K&&G.scrollTop(0),ln(r)&&(r.hasClass(S)?Et(i)&&(t.is("standard")?tn():wt(i)):(Zt(i),dn()))}function fn(e,n){if(t.is("standard")){if(e.hasClass(g)&&Et(n))return!1;if(e.hasClass(y))return!1}return e.hasClass(j)?e.hasClass(F)?!1:t.is("small")||Modernizr.touch?!0:!1:n.hasClass("header-nav-sign-in-group")?!1:!0}function ln(e){return!t.is("standard")||!e.hasClass(l)}function cn(){var t=e("#header-nav-ship-to-foreign");t.length&&Zt(jt(t))}function hn(){e(k).each(Jt).scroll(Jt)}function pn(){e("html").hasClass("touch")?e("#page, #header-main").on("click",vn):e("html").hasClass("no-touch")&&e("body").on("click",vn),Q.on("keyup"+i,gn)}function dn(){e("#header-nav-language .header-nav-country-link").on("click",function(t){t.stopPropagation(),t.preventDefault();var n=window.location.pathname,r=e(this).attr("href"),i=e(this).data("old_lang"),s=n.replace(i,r);window.location.href=s})}function vn(n){var r=mn(n),i=ft.filter(r).length,s=ft.find(r).length,o=t.is("small")&&e(n.target).attr("type")==="submit",u=t.is("medium")||t.is("standard");!i&&!s&&(o||u)&&tn(),e(".header-nav-parent-search").hasClass("_active")&&!i&&(e.event.trigger("closing_search"),tn()),t.is("standard")&&e.event.trigger("closing_search")}function mn(t){var n=t.target||t.srcElement;return e(n)}function gn(e){yn(e)&&tn()}function yn(e){return e.which===27}function bn(){wn(),xn(),Nn()}function wn(){Y.on("focus"+i,I,En).on("blur"+i,I,Sn)}function En(){n.preventTouchScroll(!0)}function Sn(){n.preventTouchScroll(!1)}function xn(){r.isCompatible()&&r.supportsTouch()&&n.resize(Tn)}function Tn(){at.blur(),e.event.trigger("closing_search")}function Nn(){r.isCompatible()||(Cn(),n.resize(Cn))}function Cn(){e(O).each(kn)}function kn(){var n=e(this),r=t.is("standard")?Ln(n.parent()):"";n.css("right",r)}function Ln(e){return e.length?n.get().width-e.offset().left+"px":""}function An(t){var n=e(this),r=this.scrollTop,i=this.scrollHeight,s=n.height(),o=t.type=="DOMMouseScroll"?t.originalEvent.detail*-40:t.originalEvent.wheelDelta,u=o>0,a=function(){return t.stopPropagation(),t.preventDefault(),t.returnValue=!1,!1};if(!u&&-o>i-s-r)return n.scrollTop(i),a();if(u&&o>r)return n.scrollTop(0),a()}function On(e){var t=e.targetTouches;t===undefined&&(t=e.originalEvent.touches),t=t[0];var n=t.pageY>this.lastY&&typeof t!="undefined",r=!n;this.lastY=t.pageY,n&&this.allowUp||r&&this.allowDown?e.stopPropagation():e.preventDefault()}function Mn(e){var t=e.originalEvent.touches;t===undefined&&(t=e.targetTouches),t=t[0],this.allowUp=this.scrollTop>0,this.allowDown=this.scrollTop<this.scrollHeight-this.clientHeight,this.prevTop=null,this.prevBot=null,this.lastY=t.pageY}function _n(){G.addClass(B)}function Dn(){var n=e(".header-nav-parent-ship-to"),r="overlay-open",i=G.hasClass(M);if(t.is("small")||t.is("medium")){var s=e(".header-nav-group-ship-to .header-nav-ship-to-overlay-wrapper");n.removeClass(r),s.is(":visible")&&s.hide(),i&&e("#header-nav").addClass(x)}else n.addClass(r),i&&Z.removeClass(u).removeAttr("style")}function Pn(){mt.on("click",Hn)}function Hn(){e(dt).slideUp(),vt.animate({top:0})}var i=".header",s=".header-nav-drawer-child",o="data-header_nav_drawer_id",u="only-scroll-nav-drawer",a="data-header_nav_group_id",f="header-nav-parent",l=f+"-non-standard",c="."+f,h=c+"-mutually-exclusive",p="header-nav-group",d="."+p,v="header-nav-child",m="."+v,g=f+"-link",y=g+"-standard",b=p+"-hover",w="."+b,E=m+"-focus",S="_hover",x="_active",T="_active-current",N=200,C=N+300,k=".header-nav-scrollable",L="_is_not_at_top",A="_is_not_at_bottom",O=".header-nav-fixed",M="_header-nav-is-open",_="_header-nav-level-one-is-open",D="_header-nav-level-two-is-open",P="_header-nav-mutually-exclusive-is-open",H=".header-nav-parent-ship-to",B="header-countries",j="header-nav-parent-favorites",F="header-nav-parent-favorites-empty",I="input:not(.open-datepicker,[type=date],[type=datetime],[type=checkbox],[type=radio],[type=file]), textarea",q="header-focus-search-state",R="nav-back-white",U="drawer-white",z=0,W=0,X=null,V=null,$=["header-nav-sign-in","header-nav-saved-items","header-nav-favorites","header-nav-client-services"],J="header-nav-child-assitance",K=r.isIOSDevice(),Q=e("html"),G=e("body"),Y=e("#header-main"),Z=e("#page"),et=Y.find(".header-nav-parent-main"),tt=Y.find(".header-nav-back"),nt=Y.find("#header-nav"),rt=nt.find("#header-nav-child-main"),it=nt.find(s),st=Y.find(c),ot=e(d),ut=Y.find(m),at=e("#header-nav-search-input"),ft=et.add(tt).add(rt).add(st).add(ot).add(ut),lt=e("._shadow-wrapper-top"),ct=e("._shadow-wrapper-bottom"),ht=e(".header-nav-back"),pt=".move-header-if-lt-ie10",dt=".unsupported-browsers-message-wrapper",vt=e(pt),mt=e(dt+" .close-message-button");return{load:function(){gt(),cn(),hn(),pn(),bn(),Dn(),Pn(),dn(),e(H).on("click",_n),t.change(function(){if(!e(H).hasClass("_active")){var t=e(e(H).attr("href"));t.is(":visible")&&t.hide()}Dn()}),t.is("small")&&e("#header-nav-bag").addClass("prevent-document-scroll")},closeNav:function(e){var t=jt(e);t.length&&wt(t,!0)}}});
