define(["jquery","viewport","breakpoints","ajaxLoader","copyLink","savedItems"],function(e,t,n,r,i,s){function U(t){t.preventDefault();var n=e(this);n.hasClass("_"+o)?(n.removeClass("_"+o),e(f).removeAttr(l)):(n.addClass("_"+o),e(f).data(l,l))}function z(t){var n=B.find("[data-slick-index="+t+"]").data("name"),r=B.find("[data-slick-index="+t+"]").data("videoid"),i=B.find("[data-slick-index="+t+"]").data("collection");e("."+c).trigger("ready"),L.html(n),A.html(i),_.removeClass(u);var s=e("li.parent-video-button",e(".look-information-carousel"));r==undefined||r==""?s.hide():s.show();if(e("#shop-this-url").length){var o=e("#shop-this-url").val()+""+B.find("[data-slick-index="+t+"]").data("id");e("#shop-this-url").next("a").prop("href",o)}}function W(e){var t=H.find("[data-slick-index="+e+"]").data("favorite"),n=O.attr("data-save-item"),r=O.hasClass("_active");typeof n!="undefined"&&H.find("[data-id="+n+"]").data("favorite",r);var i=H.find("[data-slick-index="+e+"]").data("id");O.attr("data-save-item",i),M.removeClass(o),M.eq(0).addClass(o),M.eq(3).addClass(o),t?O.addClass("_"+o):O.removeClass("_"+o)}function X(t){t.each(function(){if(e(this).hasClass("_loading")){var t,r=e("html").hasClass("retina")?"_retina":"";n.is("small")?t=$(e(this).data("src_small"+r)):t=$(e(this).data("src_standard"+r)),e(this).attr("src",t.src),e(this).removeClass("_loading")}})}function V(t){var n=B.find("[data-slick-index="+t+"]").data("id"),r="-p-"+n+"/look/print";console.log(n),e(".print-help > .print > a").attr("href",r)}function $(e){var t=new Image;return t.src=e,t}function J(t){t.preventDefault();var n=e(this),r=n.data("view");switch(r){case"front":n.hasClass(o)||(e("."+a+" ._removed-from-back").length&&(e("._removed-from-back").addClass(N),e("._removed-from-back").removeClass("_removed-from-back")),e("."+N).addClass(N),e("."+a+" ."+T).hide(),e("."+a+" ."+b).fadeIn(),M.removeClass(o),n.addClass(o),e("."+N).bind("click touchmove touchstart"),e("."+a).removeClass(C),H.removeClass("_video-active").removeClass("_video-complete"));break;case"back":n.hasClass(o)||(e("."+a+" ."+T).hide(),e("."+a+" ."+y).fadeIn(),M.removeClass(o),n.addClass(o),e("."+N).bind("click touchmove touchstart"),e("."+a+" ."+N).addClass("_removed-from-back"),ot(),e("."+a+" ."+N).removeClass(N),e("."+a).removeClass(C),H.removeClass("_video-active").removeClass("_video-complete"));break;case"video":n.hasClass(o)||(e("."+a+" ."+T).hide(),e("."+a+" ."+x).fadeIn(),M.removeClass(o),n.addClass(o),e("."+a).addClass(C),_.removeClass(u))}}function K(t){t.preventDefault();var n=I-300,r=e("#header-main").height(),i=e("."+c).offset().top-r;e(window).scrollTop()>=n?e("html, body").animate({scrollTop:0},500):e(window).scrollTop()<=n&&e("html, body").animate({scrollTop:i},500)}function Q(t){var n=e("."+g),r=H.find("[data-slick-index="+t+"]");q=setTimeout(function(){r.find(".carousel-look-back").fadeOut("slow",function(){n.find(".carousel-look-front").show(),n.find(".carousel-look-back").hide(),n.find(".carousel-video").hide(),H.removeClass("_video-active"),H.removeClass("_video-complete")})},500)}function G(t){X(t.prev().find("img")),X(t.find("img")),X(t.next().find("img")),H.removeClass("_is-loading"),e(".spinner-wrapper").removeClass("global-standard-spinner")}function Y(e){r.loadJson(w,E,H.find(".slick-active"),S,e,[Z])}function Z(t){if(t.length==2){var n=t[1],r=t[0][n],i=r.items;if(i.length>0){var o=[],u={};for(var a=0;a<i.length;a++){var f=i[a];u={},u.name=f.title,u.id=f.productCode,u.price=f.rawPrice,u.category=f.categoryPath,u.variant=f.variant,u.list="LookDetailsCarouselComponent",u.position=a+1,o.push(u)}var l={event:"productImpression",ecommerce:{impressions:o}};dataLayer.push(l);if(r.socialList){for(var a=0;a<r.socialList.length;a++){var c=r.socialList[a];c.cssClass?c.linkUrl?e("."+c.cssClass).attr("href",c.linkUrl):e("."+c.cssClass).attr("href","#"):(e(".share-facebook").attr("href","#"),e(".share-twitter").attr("href","#"),e(".share-pinterest").attr("href","#"),e(".share-email").attr("href","#share-by-email-overlay"))}e(".social-overlay-header h3").text(r.socialLookTitle),e(".share-email").attr("data-socialTitle",r.socialLookTitle).attr("data-socialDescription",r.socialLookDescription).attr("data-socialUrl",r.socialLookUrl),e(".social-overlay-link").text(r.socialLookUrl).val(r.socialLookUrl)}}}s.fillSavedItems()}function et(t,n,r,i){z(i);var s=".slick-active ._removed-from-back";e(s).length&&(e(s).addClass("zoom-in"),e(s).removeClass("_removed-from-back"))}function tt(e,t,n){var r=B.find("[data-slick-index="+n+"]").data("id").toString();it(),n!==j&&(j=n,G(B.find("[data-slick-index="+n+"]")),W(n),Q(n),Y(r))}function nt(t){var r=e("#header-main").height(),i=e(".look-information").height(),s=e("#footer-main").offset().top-r-i,o=P.offset().top,u=e(t.target).scrollTop(),a=u+100,f=!n.is("small"),l=n.is("medium"),c=n.is("standard");f&&u>0&&(F||(o>=s&&a>=s&&c?P.css({top:s+1}).addClass(h):o>=s&&a>=s-40&&l?P.css({top:s+1}).addClass(h):e(window).scrollTop()+r<=s&&u>0?P.css({top:"240px"}).removeClass(h):P.css({top:s+1}).addClass(h)),e(window).scrollTop()>=I-300?D.find("a").html(D.attr("data-label2")).removeClass(m).addClass(v):e(window).scrollTop()<=I-300&&D.find("a").html(D.attr("data-label1")).removeClass(v).addClass(m))}function rt(){R=P.outerHeight(),I=e("."+c).offset().top,P.addClass("show-look-information"),F&&!n.is("small")&&setTimeout(function(){st()},800)}function it(){n.is("small")||(e("."+N).unbind("click touchmove touchstart"),e(f).removeClass(N))}function st(){var t=e("."+c),n=65,r=t.position().top+t.height()-n;P.css({height:r})}function ot(){e(y).click(function(){return!1})}function ut(){M.bind("click touchstart",J),D.bind("click touchstart",K),e("."+c).bind("ready",rt),e(window).bind("scroll",nt),B.on("beforeChange",et),B.on("afterChange",tt),e(".looks-detail-video").on("click",".video-share",function(){var t=e(this).closest(".looks-detail-video");t.find(".zclip").length||i.buildCopyLinks(t)})}var o="active",u="_disabled",a="slick-active",f="."+a,l="favorite",c="looks-gallery-container",h="classAbsolute",p="FEATURED PIECES IN THIS LOOK",d="VIEW LOOK",v="arrow-to-up",m="arrow-to-down",g="carousel-slide",y="carousel-look-back",b="carousel-look-front",w="looks-detail",E="content-looks-gallery-items",S="product-tiles-grid-item",x="carousel-video",T="carousel-look-side",N="zoom-in",C="hide-zoom-icon",k=e("."+l),L=e(".id-look-current"),A=e(".collection-look-current"),O=e(".collection-title ."+l),M=e(".views-video a"),_=e(".views-video .parent-video a"),D=e(".featured-pieces"),P=e(".look-information-box"),H=e(".looks-detail-carousel"),B=H.find(".carousel-inner"),j,F=e("html").hasClass("iOS"),I,q,R;return{load:function(){ut(),G(H.find(".slick-active")),z(H.find(".slick-active").data("slick-index")),Y(H.find(".slick-active").data("id")),W(H.find(".slick-active").data("slick-index")),F&&!n.is("small")&&(e("body").addClass("looks-detail-page"),n.change(st))}}});
