define(["jquery","breakpoints","handlebars"],function(e,t,n){function C(n){!t.is("small")&&!t.is("medium")?(n.type==="focus"&&(e(m).addClass(g),e(r).addClass(y),e(p).addClass(s),e(u).removeClass(s),e(a).removeClass(s),e(o).addClass(c),e(i).addClass(h),e(r).removeAttr("placeholder"),e(i).text(e(r).attr("data-placeholder"))),k()):n.type!=="focus"&&(e(o).addClass(c),e(r).attr("placeholder",e(r).attr("data-placeholder")),e(i).text(""),k())}function k(){e(w).on("click touchstart touchend touchmove",L),!e("html").hasClass("touch")&&!t.is("standard")&&S.addClass("_lock-it")}function L(){event.stopPropagation(),e(r).is(":focus")&&e(r).trigger("blur")}function A(t,r,i,o,u){var a=e("#template-list-products").html(),f=n.compile(a),l={title:r,description:i,url:o,primaryImage:t,productCode:u},c=f(l),h=".search-flyout-products";e(h+" ul").append(c),e(h).removeClass(s)}function O(t,r){var i=e("#template-list-categories").html(),o=n.compile(i),u={title:t,url:r},a=o(u),f=".search-flyout-categories";e(f+" ul").append(a),e(f).removeClass(s)}function M(t,r,i){var o=e("#template-list-articles").html(),u=r.substring(0,120),a=n.compile(o),c={title:t,description:u,url:i},h=a(c);e(f+" "+l).append(h),e(f).removeClass(s)}function _(t,r){var i=e("#template-no-suggestions").html(),s=".search-flyout-no-suggestions",o=n.compile(i),u={title:t,url:r},a=o(u);e(s+" ul").append(a),e(s).removeClass("hide-flyout-section"),e(s+" .section-title").show(),e(s+" .search-flyout-no-found").hide(),U()}function D(){e(E).removeClass(s),e(E+" li").length>0?(e(E+" .section-title").show(),e(E+" .search-flyout-no-found").removeClass("suggestion-no-border")):(e(E+" .section-title").hide(),e(E+" .search-flyout-no-found").addClass("suggestion-no-border")),e(E+" .search-flyout-no-found").show(),U()}function P(t,n){var s=e(r).val(),o=s.length,u=s.substr(0,o),a=t.length,f=t.substr(o,a);e(i).text(u+f),n.keyCode==39&&(e(r).val(t),e(i).text(""))}function H(t,n){var i=e(r).val().toLowerCase(),s=e(r).val(),o=new RegExp(i),u=new RegExp("^"+s+".*$"),a=t.length,f,l,c,h,p,d,v,m,g,y=0,b=e("#predictive-search-enabled").data("product-suggestions-enabled"),w=e("#predictive-search-enabled").data("category-suggestions-enabled"),E=0,S=!0,T=!0,N=!0;for(y;y<a;y++){f=t[y].title,l=t[y].title.toLowerCase(),t[y].description!==undefined?c=t[y].description.toLowerCase():c="";switch(t[y].section){case x[0]:T=!1,p=t[y].imageData,d=t[y].title,v=t[y].description,m=t[y].productCode,E++,g=t[y].url+"?listName=SearchBoxComponent&position="+E,A(p,d,v,g,m);break;case x[1]:d=t[y].title,g=t[y].url,N=!1,O(d,g);break;case x[2]:d=t[y].title,v=t[y].description,g=t[y].url,M(d,v,g);break;case x[3]:d=t[y].title,_(d,"/search/?text="+d),(l.match(i)||f.match(u))&&S&&(h=t[y].title,P(h,n),S=!1)}}b&&T||w&&N?D():B(t)}function B(e){var t=[],n={};for(var r=0;r<e.length;r++){var i=e[r];x[0]==i.section&&(n={},n.name=i.title,n.id=i.productCode,n.price=i.price,n.category=i.categoryPath,n.variant=i.variant,n.list="SearchBoxComponent",n.position=r+1,t.push(n))}if(t.length>0){var s={event:"productImpression",ecommerce:{impressions:t}};dataLayer.push(s)}}function j(){e(o).addClass(b)}function F(){e(o).removeClass(b)}function I(){e(".header-nav-child-focus").html(""),e(p).addClass(s),e(a).removeClass(s),e(d).removeClass(s).find("ul").append(e(d).find("li")),!t.is("small")&&!t.is("medium")?e(o).hasClass(b)||(e(r).val().length>0?e(r).removeAttr("data-placeholder"):(e(r).attr("placeholder")===undefined||e(r).attr("data-placeholder")===undefined)&&e(r).attr("data-placeholder","Search products").attr("placeholder","Search"),e(r).removeClass(y),e(o).removeClass(c),e(i).removeClass(h),e(i).text(""),e(m).removeClass(g)):(e(o).removeClass(c),e(i).removeClass(h),e(r).attr("placeholder","Search")),e(w).off("click touchstart touchend touchmove",L),S.removeClass("_lock-it")}function q(n){var r=t.is("small")||t.is("medium"),i=e("#header-nav-search").hasClass("_active");!i&&r&&I(n)}function R(t){var n=e(r).val(),o=e(r).val().length;e(i).text(""),e(f+" "+l).empty(),e(p+":not("+u+", "+a+") ul").empty(),e(p).addClass(s),"undefined"!=typeof T&&o>=T&&(N.push(n),e.ajax({url:v+n,type:"GET",dataType:"json"}).done(function(e){var r=!1;N.length>1&&N.lastIndexOf(n)==N.length-1&&(N.push(""),r=!0),r&&H(e,t)})),o===0&&(e(r).attr("placeholder")!==undefined&&e(r).removeAttr("placeholder"),e(i).text(e(r).attr("data-placeholder")))}function U(){Modernizr.touch&&setTimeout(function(){myScroll.refresh()},0)}function z(){e(document).bind("closing_search",I),e(document).bind("open_search",C),e(r).bind("input propertychange",R),e(r).bind("focus",C),e(r).bind("blur",q),e(o).bind("mouseenter",j),e(o).bind("mouseleave",F),e(r).on("click touchstart touchend touchmove",function(e){e.stopPropagation()})}function W(){n.registerHelper("breaklines",function(e){return e=n.Utils.escapeExpression(e),e=e.replace(/(\r\n|\n|\r)/gm,"<br>"),new n.SafeString(e)})}var r="#header-nav-search-input",i="#header-nav-search-input-disabled",s="hide-flyout-section",o=".search-flyout",u=".search-flyout-recent",a=".search-flyout-section-keywords",f=".search-flyout-articles",l=".search-flyout-articles-content",c="search-flyout-show",h="focus-disabled",p=".search-flyout-section",d=".search-flyout-recent",v=hybris.contextPath+"/search/autocomplete/SearchBoxComponent?term=",m=".header-nav-search-submit",g="submit-focus-state",y="input-focus",b="classHover",w="#scroll-wrapper",E=".search-flyout-no-suggestions",S=e("body"),x=["Products","Categories","Articles","Suggestion"],T=e(r).attr("data-trigger-predictive-count"),N=[];return{load:function(){z(),W();var t=e(document.activeElement);t.attr("id")=="header-nav-search-input"&&t.trigger("focus")}}});
