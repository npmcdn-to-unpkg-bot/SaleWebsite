define(["jquery","dispatcher","ajaxConfig","jsonHtml","loader","imageLoader","gucciJsonHtml"],function(e,t,n,r,i,s,o){function b(){e(window).ready()&&e(".product-tiles-grid .ajax-loader-link").css({display:"inline-block"}).on("click",w)}function w(t){var n=e(this),r=n.attr("data-url");r==null&&(r=n.attr("href")),x(t),E(r,n.attr(a),n,n.attr(h))}function E(n,u,a,h,b,w){var E=n,S=e("."+u),x=d+" "+v;i.updateElementClass(S,p,x),i.updateElementClass(a,p,x);var T="",N=a.attr("ID");N=="filterSortSelect"&&(n="product-tiles-grid-2");var C=y[n.toUpperCase()];C||(C=n);if(N=="looksGridLoadMoreLnk"||N=="productGridLoadMoreLnk"){var k=a.attr(l),T="categoryCode="+a.attr(f),L=location.href.match(/.+sort=([^&]*)/i,"$1"),A=location.href.match(/.+filter=([^&]*)/i,"$1");L!=null&&(T+="&sort="+L[1]),A!=null&&(T+="&filter="+A[1]),k!=null&&(k==2?T=T+"&page=0"+"&show=All":T=T+"&page="+k)}else if(N=="searchResultsLoadMoreLink"){var k=a.attr(l),T="filter="+a.attr(c),L=location.href.match(/.+sort=([^&]*)/i,"$1"),A=location.href.match(/.+filter=([^&]*)/i,"$1");L!=null&&(T+="&sort="+L[1]),A!=null&&(T="filter="+A[1]),k!=null&&(k==2?T+="&show=All&page=0":T=T+"&show=Page&page="+k)}else if(N=="filterSortSelect")T="categoryCode="+a.attr(f)+"&sort="+E,e("#facetNavSelection").val()!=""&&(T=T+"&filter="+e("#facetNavSelection").val());else if(b!="undefined"&&b!=""&&b!=null)T="lookNumber="+b;else if(n=="product-tiles-grid-3"||n=="product-tiles-grid-2")T="categoryCode="+a.attr(f)+"&filter=:"+e("select.sort-select").val()+":"+e("#facetNavSelection").val();T=T.replace(/[:(.?)]+:/g,":"),e.ajax({url:C,dataType:"json",data:T}).done(function(u){u=n=="looks-detail"?[u,b]:u;if(n.indexOf("search-results-grid")!=-1||n.indexOf("product-tiles-grid")!=-1){var f=a.attr("data-componentName");g=o.compiler(u,n,a.attr(l),f)}else g=r.compiler(u,n);N!="filterSortSelect"&&n!="looks-detail"&&n!="product-tiles-grid-3"&&n!="product-tiles-grid-2"&&(g.hideButton||typeof a.attr("data-all-text")!="undefined"&&a.text().toUpperCase()==a.attr("data-all-text").toUpperCase()?a.hide():a.text(a.attr("data-all-text")));if(N=="productGridLoadMoreLnk"||N=="searchResultsLoadMoreLink"){var c=parseInt(a.attr(l));a.attr(l,c+1)}i.loadRepsonseInContainer(S,e(g.html),a,e("."+h)),s.loadImage(S),e("body").removeClass(m),typeof w!="undefined"&&t.fireCallbacks(w,u)}).fail(function(){i.showLoadError(S,a)})}function S(t,r,i){var s=t.toUpperCase();return n.getRemoteService(s)==="undefined"?(console.error("The Key ["+s+"] not exists into AJAX Config"),!1):(i==undefined&&(i="GET"),i=="POST"&&(r.CSRFToken=e("input[name=CSRFToken]").val()),e.ajax({url:n.getRemoteService(s),type:i,data:r,dataType:"JSON",cache:!1}))}function x(e){e&&e.preventDefault&&e.preventDefault()}function T(t){var n={},r=t.serializeArray();return e.each(r,function(){n[this.name]!==undefined?(n[this.name].push||(n[this.name]=[n[this.name]]),n[this.name].push(this.value||"")):n[this.name]=this.value||""}),n}var u=".ajax-loader-link",a="data-load_container",f="data-catCode",l="data-pageNumber",c="data-searchText",h="data-load_remove_class",p="_loading",d="_loaded",v="_error",m="overlay-lock",g={},y=n.config();return{load:function(){b()},loadJson:E,endPointAccess:S,serializeObject:T}});
