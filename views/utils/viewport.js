define(["dispatcher","os"],function(e,t){function A(){O(),R(),M(),_()}function O(){D(),B(),F(),q()}function M(){window.onscroll=W,G("touchstart",Y),G("touchmove",nt),G("touchend",rt),G("touchcancel",rt)}function _(){window.onresize=it,ut()}function D(){var e=["webkit","moz","o","ms"];for(var t=e.length-1;t>-1&&!window.requestAnimationFrame;t--)window.requestAnimationFrame=window[e[t]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[t]+"CancelAnimationFrame"]||window[e[t]+"CancelRequestAnimationFrame"];window.requestAnimationFrame?i=!0:window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(){})}function B(){document.documentElement.clientHeight?(P=function(){return document.documentElement.clientWidth},H=function(){return document.documentElement.clientHeight}):window.innerHeight?(P=function(){return window.innerWidth},H=function(){return window.innerHeight}):document.body.clientHeight&&(P=function(){return document.body.clientWidth},H=function(){return document.body.clientHeight})}function F(){window.pageYOffset!==undefined?j=function(){return window.pageYOffset}:document.documentElement?j=function(){return document.documentElement.scrollTop}:document.body.parentNode?j=function(){return document.body.parentNode.scrollTop}:document.body&&(j=function(){return document.body.scrollTop})}function q(){var e=0;e<=document.body.scrollHeight&&(e=document.body.scrollHeight,I=function(){return document.body.scrollHeight}),e<=document.body.offsetHeight&&(e=document.body.offsetHeight,I=function(){return document.body.offsetHeight}),e<=document.documentElement.clientHeight&&(e=document.documentElement.clientHeight,I=function(){return document.documentElement.clientHeight}),e<=document.documentElement.scrollHeight&&(e=document.documentElement.scrollHeight,I=function(){return document.documentElement.scrollHeight}),e<=document.documentElement.offsetHeight&&(e=document.documentElement.offsetHeight,I=function(){return document.documentElement.offsetHeight})}function R(){r.width=P(),r.height=H(),r.scrollBottomMax=I(),r.scrollTopMax=r.scrollBottomMax-r.height,r.scrollTop=Math.min(r.scrollTopMax,Math.max(U(),0)),r.scrollBottom=r.scrollTop+r.height}function U(){return l?z():j()}function z(){var e=p-d,t=m-v;return h+e+t}function W(){t.supportsTouch()||X(o,s,V)}function X(e,t,n){e||(e=!0,window.cancelAnimationFrame(t),t=window.requestAnimationFrame(n))}function V(){o=!1;var e=r.scrollTop;if(!f){J();return}R(),K(),Q("scroll",r,l),e>r.scrollTop?Q("scrollUp",r,l):e!=r.scrollTop&&Q("scrollDown",r,l)}function J(){var e=setInterval(function(){j()==x&&(f=!0,clearInterval(e))},1)}function K(){clearTimeout(b),r.scrollDistance=r.scrollTop-r.scrollStart,b=setTimeout(function(){r.scrollStart=r.scrollTop},w)}function Q(t,n,r){r?e.fireCallbacks(E.touch[t],n):e.fireCallbacks(E[t],n)}function G(e,t){document.addEventListener?document.addEventListener(e,t):document.attachEvent&&document.attachEvent(e,t)}function Y(e){c&&(h=r.scrollTop,v=m=Z(e),p=d=tt(e))}function Z(e){return et(e).pageY}function et(e){var t=e.touches||e.changedTouches||e.originalEvent.touches||e.originalEvent.changedTouches;return t[0]}function tt(e){return et(e).clientY}function nt(e){if(!c){e.preventDefault();return}m=Z(e),d=tt(e),l=!0,V(),l=!1}function rt(){c&&V()}function it(){X(a,u,st)}function st(){a=!1,R(),y!==r.width&&e.fireCallbacks(E.resize,r),g!==r.height&&e.fireCallbacks(E.resizeHeight,r),y!==r.width&&e.fireCallbacks(E.resizeWidth,r),g=r.height,y=r.width}function ot(e,t,n){var r;return function(){var i=this,s=arguments,o=function(){r=null,n||e.apply(i,s)},u=n&&!r;clearTimeout(r),r=setTimeout(o,t),u&&e.apply(i,s)}}function ut(){var e=ot(function(){at()},250);$(window).on("resize",e)}function at(){T!=I()&&(T=I(),st())}function ft(e,t,n){E[e].indexOf(t)===-1&&E[e].push(t),n&&E.touch[e].indexOf(t)===-1&&E.touch[e].push(t)}function lt(e,t){var n=document.querySelector(e),r=ct(n).y,i={},s=0;return t&&(i=document.querySelector(t),s=ct(i).y+i.offsetHeight),r-s}function ct(e){var t=0,n=0;while(e)e.style.display="block",t+=e.offsetLeft+e.clientLeft,n+=e.offsetTop+e.clientTop,e.style.display="",e=e.offsetParent;return{x:t,y:n}}function ht(e,t,n,r){var s=(new Date).getTime();if(i)window.cancelAnimationFrame(C),C=window.requestAnimationFrame(function(){pt(e,t,s,n,r)});else{var o=n/10;clearTimeout(N),gt(e,t,o,r)}}function pt(t,n,i,s,o){var u=(new Date).getTime(),a=t-r.scrollTop,f=(u-i)/s*a%a||0,l=r.scrollTop+f;u>=i+s&&(l=t),dt(l),mt(l,t,n)?C=window.requestAnimationFrame(function(){pt(t,n,i,s,o)}):e.fireCallbacks([o],r)}function dt(e){vt(e),V()}function vt(e){window.scrollTo(0,e)}function mt(e,t,n){var r=e<t&&n,i=e>t&&!n;return r||i}function gt(t,n,i,s){if(i<0)return;var o=t-r.scrollTop,u=o/i*10,a=r.scrollTop+u;N=setTimeout(function(){dt(a),mt(a,t,n)?gt(t,n,i-10,s):e.fireCallbacks([s],r)},10)}var n=1e3,r={width:0,height:0,scrollStart:0,scrollDistance:0,scrollTop:0,scrollTopMax:0,scrollBottom:0,scrollBottomMax:0},i=!1,s=null,o=!1,u=null,a=!1,f=!0,l=!1,c=!0,h=0,p=0,d=0,v=0,m=0,g=0,y=0,b=null,w=300,E={scroll:[],scrollUp:[],scrollDown:[],touch:{scroll:[],scrollUp:[],scrollDown:[]},resize:[],resizeHeight:[],resizeWidth:[]},S={top:0},x=0,T=0,N=null,C=null,k,L,P,H,j,I;return A(),{scroll:function(e,t){ft("scroll",e,t)},scrollUp:function(e,t){ft("scrollUp",e,t)},scrollDown:function(e,t){ft("scrollDown",e,t)},preventTouchScroll:function(e){c=!e},resize:function(e){E.resize.push(e)},resizeWidth:function(e){E.resizeWidth.push(e)},resizeHeight:function(e){E.resizeHeight.push(e)},scrollTo:function(e,t,i,s){R(),k=$("html").hasClass("iPad")?!0:!1,L=navigator.userAgent.match(/(iPad|iPhone|iPod touch);.*CPU.*OS.*8/)?!0:!1;var o=lt(e,t),u=o>r.scrollTop,a=Math.max(o,0),f=Math.min(a,r.scrollTopMax),l=i||n;ht(f,u,l,s)},scrollToManualOffsetAdded:function(e,t,i,s,o){R(),k=$("html").hasClass("iPad")?!0:!1,L=navigator.userAgent.match(/(iPad|iPhone|iPod touch);.*CPU.*OS.*8/)?!0:!1;var u=lt(e,t)-o,a=u>r.scrollTop,f=Math.max(u,0),l=Math.min(f,r.scrollTopMax),c=i||n;ht(l,a,c,s)},get:function(){return r},setScrollTopNamespace:function(e){S[e]=r.scrollTop},resetScrollTopNamespace:function(e){var t=S[e];typeof t!="undefined"&&(x=t,f=!1,vt(x))},setScrollTop:function(e){vt(e)},unsetScrollTop:function(e){delete S[e]}}});
