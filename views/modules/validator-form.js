define(["jquery","tooltip","breakpoints","handlebars"],function(e,t,n,r){function l(t,i,s,u){var a=t!==undefined?e(t.currentTarget).closest("form"):i,f=e(":input:visible, select, .validate-hidden",a),l=!0,c=n.is("small"),p="error-state",d="error-small",v="previous-error-state",m,g,y,b,w,E,S=a.data("error-messages");h(t),e(S).empty(),c&&(a.find("."+d).remove(),a.find("."+p).removeClass("."+p),a.find("."+v).removeClass("."+v)),f.removeClass("error"),a.find(".selectric").removeClass("error");if(typeof u!="undefined"||u)return!1;e.each(s.fieldsInError,function(t,n){var r="",i;m=f.filter('[name="'+t+'"]'),g=m.data("tooltip"),y=jQuery.trim(m.val()),b=m.is("select"),w=m.data("valid")||m.attr("type"),m.addClass("error"),typeof g!="undefined"&&e(o,g).text(n),E=m.data("previous-err-state"),i=m.next("."+d).length===0||m.parents(".selectricWrapper").next("."+d).length===0;if(c&&i){var s=e(o,g).clone(),u=m;s.addClass(d).insertAfter(u);var a=m.parent(".input-content");b&&a.length===0&&(a=m.parents(".input-content")),a.addClass(p)}typeof E!="undefined"&&m.parent().parent().find("."+E).addClass(v),r=m.parent().find("label").first().clone(),r.find("div").length>0&&r.find("div").remove(),r=r.text().trim(),r===""&&(r=m.data("label")),b&&(m.parents(".selectricWrapper").find(".selectric").addClass("error"),r=m.parent().parent().parent().find("select").data("label").trim()),m.hasClass("validate-hidden")&&(m.is(":visible")||e(".edit-email").not(".cancel-edit").click())});var x=e("script#checkout-error-message-placeholder").html(),T=r.compile(x);e(S).html(T(s));var N=i.find(".error").first();return N.length>0&&e("html, body").animate({scrollTop:N.parent().offset().top-(parseInt(e("header").css("height").replace("px",""),10)+35)},20),l}function c(e){e.find("input").removeClass("error").val(""),e.find(".selectric").removeClass("error").val("0"),e.find(".selectricWrapper").removeClass("error")}function h(e){e&&e.preventDefault&&e.preventDefault()}function p(){var r=e(this),i=!n.is("small"),s=r.hasClass("error");s&&i&&t.close(r.parent().find("select").data("tooltip"))}function d(){var r=e(this),i=!n.is("small"),s=r.hasClass("error"),o=r.parent().find("select").data("tooltip");s&&i?t.open(o):t.close(o)}function v(){var r=e(this),i=!n.is("small"),s=r.hasClass("error"),o=e("html").hasClass("iOS");s&&i&&t.close(r.data("tooltip")),o&&e("#header-main-checkout").css({position:"fixed"})}function m(){var r=e(this),i=!n.is("small"),s=r.hasClass("error"),o=e("html").hasClass("iOS");s&&i&&t.open(r.data("tooltip")),o&&e("#header-main-checkout").css({position:"absolute"})}function g(){a.on("focus",m),a.on("blur",v),e('.italy-form.corporate-company input[required="required"]').on("focus",m),e('.italy-form.corporate-company input[required="required"]').on("blur",v),f.on("click",d),f.on("mouseout",p),u.on("click touchstart",l)}var i=".validator-form form",s="button.button-validator-form",o=".tooltip-message",u=e(s),a=e(i+" :input").filter('[required="required"]'),f=e(i+" select").filter('[required="required"]');return{load:function(){g()},returnValue:function(e){return l(e)},cleansForm:function(e,t){return l(undefined,t,[],!0)},checkThis:function(e,t){return l(undefined,e,t)},removeErrorClassAndCleanFields:c}});
