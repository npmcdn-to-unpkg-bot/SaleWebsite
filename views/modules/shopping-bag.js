define(["jquery","handlebars","tooltip","overlay","emailSavedItems","os","ajaxConfig","ajaxLoader","removeProductShoppingBag","headerUpdate"],function(e,t,n,r,i,s,o,u,a,f){function Ct(t){var n=e(this).val(),r=e(this).data("last-value"),i=0,s=e(this).data("maxlength"),o,u=e(this).parents("aside.shopping-bag-product-overlay");e("body").hasClass(".touch")&&(i=200);if(r!=n)var a=setTimeout(function(){o=e(".input-initials");var t=kt(n,r,s);o.val(t),o.data("last-value",t),Ot.saveProductOverlayInformation(u,{"selected-initials":o.val()}),Lt(o)},i)}function kt(t,n,r){var i="",s,o,u,a,f=e(".dots-enabled").val()=="true",l=t.length<n.length;return f?l?(r==2?s=t.match(/^(?:[a-zA-Z]\.){0,2}/):s=t.match(/^(?:[a-zA-Z]\.){0,3}/),s&&s.length&&(i=s[0])):(o=t.split(".").join(""),r==2?s=o.match(/[a-zA-Z]{0,2}/):s=o.match(/[a-zA-Z]{0,3}/),a=s[0].split(""),u=a.join("."),u.length&&(i=u+".")):(o=t.split(".").join(""),r==2?s=o.match(/[a-zA-Z]{0,2}/):s=o.match(/[a-zA-Z]{0,3}/),s.length&&(i=s[0])),i}function Lt(t){var n=e(".initials-counter"),r=t.val().length,i=e(".dots-enabled").val()=="true";t.length&&(i?n.attr("data-chars",parseInt(r/2)):n.data("data-chars",parseInt(r)))}function At(t){bt=e(this).is(":checked");var n=e(t.data.$container[0]),r=e(".input-initials",n),i=bt?r.attr("maxlength")*2-1:parseInt(r.attr("maxlength")/2,10)+1,s,o="",u=".";bt?e(".dots-enabled").val("true"):(o=".",u="",e(".dots-enabled").val("false")),s=r.val().split(o),r.val(s.join(u)+u),r.prop("maxlength",i),Ot.saveProductOverlayInformation(n,{"selected-initials":n.find(".input-initials").val(),"style-initials-enable-periods":bt})}var l="SHOPPING-BAG",c="SHOPPING-BAG-PRODUCT",h="SHOPPING-BAG-SHIPPING",p="SHOPPING-BAG-TAX",d="SHOPPING-BAG-CHANGE-QUANTITY",v="SHOPPING-BAG-REMOVE_ITEM",m="SHOPPING-BAG-SAVE-PRODUCT",g="click",y=".baglist-item-summary",b=y+"-",w=".custom-quantity-select",E=".edit-overlay",S=".edit-overlay-wrapper",x=".color-select-group",T="is-favorited",N=".size-select-group",C=".color-select monogram-select",k=".input-initials",L="fieldset",A="selected",O="selectric-error",M=".button-save",_="hover-state",D=".order-details-availability-status-",P=".availability-total-items",H=".order-details-availability-total-price",B=".availability-product-list-",j=".active-periods-checkbox",F=".color-select-styles",I=".size-select-group",q=".selectric-color-select",R="#calculate-tax",U="Edit Zip",z=".input-zip-code",W="input-error",X=".zip-code-error",V="_active",$=".tooltip-availability-open",J="slow",K=e(".your-selections-wrapper"),Q=e(".baglist",K),G=e("#shopping-bag-your-selections-product-overlay").html(),Y=e("#shopping-bag-your-selections-remove-product-overlay").html(),Z=e("#shopping-bag-image").html(),et=e("#shopping-bag-image-overlay").html(),tt=e(".order-summary"),nt=e(".order-details-totals-shipping-calculate",tt),rt=e(".get-shipping-button",nt),it=e("#shopping-bag-order-summary-shipping-options").html(),st=e(".order-details-shipping-costs"),ot=e(".order-details-totals-tax",tt),ut=e(".shopping-bag-calculate-text",ot),at=e(".shopping-bag-calculate-tax",ot),ft=e(".button-close-tax",ot),lt=e(".get-tax-button",ot),ct=e(".order-details-availability-totals",tt),ht=e("#shopping-bag-order-summary-availability-product-list"),pt=["January","February","March","April","May","June","July","August","September","October","November","December"],dt=K.data("currency"),vt=parseInt(e(".shopping-bag-content").css("padding-top"),10),mt,gt,yt,bt,wt,Et,St,xt={allowance:"0",shipping:"0",subtotalPrice:"0",totalPrice:"0",taxPercentage:"0"},Tt=!1,Nt={formatPrice:function(e){var t=e.toString().split("."),n=t[0].toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),r=n;if(e===null)return;return typeof t[1]!="undefined"&&(r+="."+t[1]),r},formatDateRange:function(e,t){var n=[],r,i,s;return e.forEach(function(e){r=e.split("/"),i=parseInt(r[0].replace(/^0+/,""),10),s=r[1].replace(/^0+/,""),t==="Month Day"?(i=pt[i],n.push(i+" "+s)):n.push(i+"/"+s)}),t==="Month Day"?n[0]+" and "+n[1]:n[0]+" - "+n[1]}},Ot={init:function(){s.isMobileDevice();var t=this;e("[data-style-id]").on(g,Ot.trackRemoveProduct),e(".baglist-item-summary").each(function(n){var r=e(this),i={},s={};t.productBindEvents(n,r,s),i=t.filterObjByKeyStartWith(r.data(),"item"),r.data("data",i)}),this.zipCodeBindEvents(),e(".touch .shopping-bag-wrapper .edit-action .overlay-open").click(function(){e("html,body").scrollTop(0)}),Ot.bindTooltips(ct.find("a.view-more"))},openTooltipAvailability:function(t){var r=e(this).attr("href");return n.open(r),t.preventDefault(),!1},hideTooltipMoreInformation:function(t){var r=e(this).attr("href");n.close(r),t.preventDefault()},renderProductOverlay:function(e,n){var r=n.find(b+e.index),i,s;t.registerHelper("eachColor",function(t){function s(e){Object.getOwnPropertyNames(e).forEach(function(t){n+='<option value="'+e[t]+'">'+r+"</option>"})}var n="",r,i;for(var o=0,u=t.length;o<u;o++)r=Object.keys(e.editableOptions.colors[o]),i=e.editableOptions.colors[o],s(i);return n}),i=t.compile(G),s=i(e),r.append(s),this.applySelectricColor(),this.applySelectricSize(),this.checkInitialStatus(r),this.bindEventsOverlay(r,e.image,e.title)},renderShoppingBagImage:function(n,r,i,s,o,u,a){var f=a.find(".image-column"),l=a.find(".edit-overlay-content-product"),c,h,p,d,v=Modernizr.touch?e(n.target).hasClass("select-touch"):e(n.target).hasClass("selected"),m={image:r,colorName:jQuery.trim(i).toLowerCase(),title:s,price:o,originalPrice:u};h=t.compile(et),d=h(m),l.fadeOut(400,function(){l.find(".edit-overlay-content-product").html(""),l.html(d),l.fadeIn(500)}),v||(c=t.compile(Z),p=c(m),f.fadeOut(400,function(){f.empty().append(p),f.fadeIn(500)}))},renderRemoveProductOverlay:function(e,n){var r=n,i=t.compile(Y),s=i(e);r.append(s)},renderEditProductOverlay:function(n,i,s){t.registerHelper("verifyChecked",function(e,t){if(e!==undefined&&e!==null&&t!==null)return e.trim()===t.trim()?'selected="selected"':""});var o=s,u=t.compile(G),a;jQuery.each(i.styles,function(e,t){t.id===i["selected-style-id"]&&(i.selectedStyle=t)}),e(E,Q).remove(),a=u(i),o.append(a);var f=o.find("aside"+E);f.data("data",i),this.applySelectricColor(f),this.applySelectricSize(f),this.checkInitialStatus(o),this.bindEventsOverlay(f,"",i.title),this.renderShoppingBagImage(n,i.selectedStyle.image,i.selectedStyle["color-label"],i.selectedStyle.title,i.selectedStyle.price,i.selectedStyle.fullPrice,f),wt=i["style-initials-enable-periods-in-textbox"],Ot.updateCharactersCounter(n,f),e(M,f).on(g,{$overlay:f},Ot.saveChangesOverlay),e(".button-continue",f).on(g,{$overlay:f},Ot.saveChangesOverlay),bt=i["style-initials-enable-periods"],i["selected-monogram-color-id"]||(i["selected-monogram-color-id"]=e("#selected-monogram-color-id").val()),this.saveProductOverlayInformation(f,{"item-id":i["item-id"],"unique-entry-number":f.data("select-item-uniquenumber"),qty:f.data("select-item-quantity"),"selected-style-id":i["selected-style-id"],"selected-size-id":i["selected-size-id"],"selected-monogram-color-id":i["selected-monogram-color-id"],"selected-initials":i["selected-initials"],"style-initials-enable-periods":i["style-initials-enable-periods"]}),i["select-item-has-stock"]?f.data("out-of-stock-item",""):f.data("out-of-stock-item",{"selected-style-id":i["selected-style-id"],"selected-size-id":i["selected-size-id"]}),Ot.checkOutOfStockItem(f);var l=f.find(".overlay-close",f);l.on("click.close-overlay",{$overlay:f},function(e){e.preventDefault(),r.close("."+e.data.$overlay.attr("class").split(" ").join("."))}),f.find(S).on("click",{$overlay:f},Ot.closeSelectrics)},handleColourChange:function(t){Ot.changeColor(t,e(t.data.$container[0]),e(this))},changeColor:function(t,n,r){var i=n.data("data"),s=r.val(),o,u,a=n.find(I),f=n.find(C);if(r.attr("id")!=="selected-monogram-color-id"){jQuery.each(i.styles,function(e,t){t.id===s&&(o=t)}),Tt=!0;var l=e(".edit-overlay-content-options"),c=l.find(".monogram-field");c.remove(),Ot.renderShoppingBagImage(t,o.image,o["color-label"].toLowerCase(),o.title,o.price,o.fullPrice,n),a.html(""),a.append(Ot.recreateOptions(o.sizes)),a.selectric("refresh"),u=o.sizes[0].id,f.html(""),f.append(Ot.recreateOptions(o["monogram-colors"])),f.selectric("refresh"),Ot.saveProductOverlayInformation(n,{"item-id":n.data("item-id"),"selected-style-id":s,"selected-size-id":u,"selected-monogram-color-id":o["monogram-colors"]?o["monogram-colors"][0].id:"","selected-initials":n.find(".input-initials").val(),"style-initials-enable-periods":n.find("#style-initials-enable-periods").is(":checked")}),Ot.checkOutOfStockItem(n)}else setTimeout(function(){Ot.saveProductOverlayInformation(n,{"selected-monogram-color-id":n.find(".color-preview").data("color-preview")})},300)},checkOutOfStockItem:function(t){e(".iOS .edit-wrapper").append('<div style="height:2000px"></div>');var n=t.data("out-of-stock-item"),r=typeof n!="undefined"&&n!=="",i=t.data("select-item")["selected-style-id"],s=t.data("select-item")["selected-size-id"],o=!0,u=t.data("data");for(var a=0;a<u.styles.length;a++){var f=u.styles[a];if(f.id==i)for(var l=0;l<f.sizes.length;l++){var c=f.sizes[l];if(c.id==s){o=c["has-stock"];break}}}r=!o,r?(e(".selectric-color-select-styles",t).addClass(O),e(".selectric-sizes-select,.sizes-select",t).addClass(O),e(".sizes-select",t).addClass("error")):(e(".selectric-color-select-styles",t).removeClass(O),e(".selectric-sizes-select,.sizes-select",t).removeClass(O),e(".sizes-select",t).removeClass("error")),Ot.enableContinueButton(t,r)},changeMonogram:function(t){var n=e(t.data.$container[0]);this.saveProductOverlayInformation(n,{"selected-monogram-color-id":e(this).val()})},saveProductOverlayInformation:function(t,n){typeof t.data("select-item")!="undefined"?t.data("select-item",e.extend({},t.data("select-item"),n)):t.data("select-item",n)},changeSize:function(t){var n=e(t.data.$container[0]);Et=e(this).val(),Ot.saveProductOverlayInformation(n,{"selected-size-id":Et}),Ot.checkOutOfStockItem(n)},enableContinueButton:function(t,n){var r=e(".button-continue",t),i=e(".button-edit",t),s=e(".button-save",t);s.prop("disabled",n),r.prop("disabled",n),n?(r.addClass(_),s.addClass(_),i.removeClass("active")):(r.removeClass(_),s.removeClass(_),i.addClass("active"))},closeSelectrics:function(t){e(".selectricWrapper",t.data.$overlay).filter(".selectricOpen").find("select").each(function(){e(this).selectric("close")})},bindEventsOverlay:function(t,n,r){var i=e(F,t).val(),s=e(F,t).hasClass("error")?i:"",o=e(I,t).val(),u=e(I,t).hasClass("error")?o:"",a=e(".select-touch",t),f=e(q,t).find(".selectric");e(j,t).on("change",{$container:t},At),e(k,t).on("input",{$container:t},Ct),e(".button-cancel").on("click",function(){Tt=!1}),e(F,t).on("change",{error:s,$container:t,image:n,title:r},this.handleColourChange),a.on("change",{$container:t},Ot.selectTouch),a.on("focus",{$container:t,$colorSelectSelectric:f},Ot.selectOpenTouch),a.on("blur",{$container:t,$colorSelectSelectric:f},Ot.selectOpenTouch),e(I,t).on("change",{error:u,$container:t},this.changeSize),e(".button-remove-from-overlay",t).on("click.remove",function(){var n=t.data("select-item")["item-id"],r=e('li[data-item-id="'+n+'"]');Ot.updateRemoveList(r)})},productBindEvents:function(t,n,r){var i=e(w,n),s=e(".button-edit",n),o=e(".button-open-remove-overlay",n),u=e(".button-wishlist",n),a=e($,n),f=e(".anchor-link",e(".your-selections-header"));i.on("change",{$container:n,index:t},this.updateProductTotalPrice),o.on(g,{$container:n,index:t,that:this},Ot.openRemoveProductOverlay),s.on(g,{$container:n,index:t,title:r.title,image:r.image},Ot.openProductOverlay),u.on(g+".save-item-remove",{$productContainer:n,index:t,fromWishlist:!0},Ot.saveForLater),a.on("mouseenter",{$container:n,index:t},Ot.openTooltipAvailability),a.on("mouseleave",{$container:n,index:t},Ot.hideTooltipMoreInformation),a.on("click",function(e){e.preventDefault()}),f.on("click",Ot.anchorLinkProduct),this.applySelectricQuantity(n);var l=e(".selectric-custom-quantity-select",n).find(".label");l.html(e(".native-select-qty-copy").html()+l.html())},bindTooltips:function(t){t.each(function(n){var r=e(this);r.on("mouseenter",{index:n},Ot.openTooltipAvailability),r.on("mouseleave",{index:n},Ot.hideTooltipMoreInformation),t.on("click",function(e){e.preventDefault()})})},anchorLinkProduct:function(t){t.preventDefault();var n=e(this).data("anchor"),r=e("."+n).offset().top-vt;e("body").animate({scrollTop:r},500)},updateCharactersCounter:function(t,n){var r=e(".input-initials",n),i=e(".initials-counter",n),s=e(".dots-enabled",n).val();if(e(".input-initials").length){var o=r.val().length;s=="true"?i.attr("data-chars",o/2):i.attr("data-chars",o)}},checkInitialStatus:function(t){var n,r,i;e(j,t).length!==0?e(j,t).each(function(){n=e(this),r=n.parent().prev(k),n.attr("checked",r.val().length>0&&r.val().indexOf(".")!==-1?!0:!1),bt=n.is(":checked"),i=r.attr("maxlength")*2-1,bt&&r.prop("maxlength",i)}):e(".dots-enabled",t).each(function(){n=e(this),r=n.parent().find(k),JSON.parse(n.val())||r.val(r.val().replace(/\./g,"")),bt=JSON.parse(e(this).val()),i=r.attr("maxlength")*2-1,bt&&r.prop("maxlength",i)})},applySelectricQuantity:function(t){var n=e(w,t),r=parseInt(t.data("item-quantity"),10)-1;n.prop("selectedIndex",r).selectric({disableOnMobile:!0,openOnHover:!0,optionsItemBuilder:function(e,t){return t.val().length?'<div class="item-quantity">'+e.text+"</div>":e.text}})},applySelectricColor:function(t){function n(e){var t=e,n=t.parents(x).find(".selectricItems ."+A).html();t.parents(x).find(".selectric .label").html(n)}e(".color-select",t).selectric({disableOnMobile:!1,onInit:function(){var t=e(this),r=e(q);n(t),r.each(function(){e(this).find(".label").prepend('</span class="color-sample"></span>').attr("data-styles",e(this).find("li").length)})},onClose:function(){var r=e(this);n(r),Ot.saveProductOverlayInformation(t,{"selected-monogram-color-id":r.val()})},optionsItemBuilder:function(e,t){return t.val().length?'<span class="color-sample"><img alt="" height="32" width="32"  data-src="'+t.data("src")+'" '+' data-src_medium="'+t.data("src-medium")+'"  '+' data-src_medium_retina="'+t.data("src-medium-retina")+'" '+' data-src_small="'+t.data("src-small")+'" '+' data-src_small_retina="'+t.data("src-small-retina")+'" '+' data-src_standard="'+t.data("src-standard")+'" '+' data-src_standard_retina="'+t.data("src-standard-retina")+'" '+' src="'+t.data("src")+'" /> '+'</span> <span class="color-value">'+e.text+'</span> <div style="clear:left;"></div>':e.text}}),e(".custom-lettering",t).selectric({disableOnMobile:!1,onInit:function(){var t=e(this),r=e(q);n(t),r.each(function(){e(this).find(".label").prepend('</span class="color-sample"></span>').attr("data-styles",e(this).find("li").length)})},onClose:function(){var r=e(this);n(r),Ot.saveProductOverlayInformation(t,{"selected-monogram-color-id":r.val()})},optionsItemBuilder:function(e,t){return t.val().length?"<span data-color-preview="+t.val()+' class="color-preview '+t.val()+'"></span>'+'<span class="color-title">'+e.text+"</span>":e.text}})},applySelectricSize:function(t){var n=e(N,t);n.selectric({disableOnMobile:!0})},recreateOptions:function(t){var n=[];return t!=null&&jQuery.each(t,function(t,r){var i=e("<option></option>").attr("value",r.id).html(r.label).data(r);n.push(i)}),n},updateProductTotalPrice:function(t){var n=e(t.data.$container[0]),r=e(".quantity-error",n),i=e(".custom-select-parent",n),s="error-select",o=e("html").hasClass("mobile")||e("html").hasClass("tablet"),u=i.data("item-maxquantity"),a=parseInt(e(this).val(),10);o&&(i=e("select.custom-quantity-select",n),s="error"),i.removeClass(s),r.hide();if(a>u)i.addClass(s),r.show();else{n.data("item-quantity",a);var f=n.data("unique-index");Ot.updateProductQuantity(f,a,Ot.reloadPage)}},selectTouch:function(t){var n=e(t.data.$container[0]),r=e(this),i=r.parents(L).find(".selectricItems li"),s=r.parents(L).find(".selectric .label"),o=t.currentTarget.selectedIndex,u=i.removeClass(A).eq(o).addClass(A).html();Ot.changeColor(t,n,e(this)),s.html(u)},selectOpenTouch:function(){var t=e(this).parent().find(".selectric");t.toggleClass("open")},openProductOverlay:function(t){t.preventDefault();var n=e(this).data("unique-index"),i="aside.edit-overlay",s=e('li[data-unique-index="'+n+'"]'),o=s.data("data"),a,f=s.data("unique-index"),l={"unique-index":f};e(i,s).remove(),a=u.endPointAccess(c,l),a.done(function(e){var n=e.data;Ot.renderEditProductOverlay(t,n,s),r.open(i)}),a.fail(function(e,t,n){console.error("The following error occurred: "+t,n)}),e(E).scrollTop(0)},filterObjByKeyStartWith:function(e,t){var n={};return jQuery.each(e,function(e,r){if(e.indexOf(t)===0){var i=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();n[i]=r}}),n},openRemoveProductOverlay:function(t){t.preventDefault();var n=e(this).data("unique-index"),i='aside[data-unique-index="'+n+'"]',s=e('li[data-unique-index="'+n+'"]'),o=s.data("data"),u;e('aside[data-unique-index="'+n+'"]',s).remove(),t.data.that.renderRemoveProductOverlay(o,s),u=s.find(".remove-from-shopping-bag-form");var f=e(i,s).find(".overlay-close");f.on("click.close-overlay",{overlaySel:i},function(e){e.preventDefault(),r.close(e.data.overlaySel)}),e("[data-style-id]").on(g,Ot.trackRemoveProduct);var l=e(i,s).find(".button-remove-from-remove-overlay");l.on("click.confirm-overlay",{overlaySel:i,$productContainer:s},function(t){r.close(t.data.overlaySel),e("body").removeClass("overlay-lock"),a.removeFromShoppingBag(u),Ot.updateRemoveList(t.data.$productContainer)}),r.open(i)},trackRemoveProduct:function(){dataLayer.push({ecommerce:{products:[{name:e(".gucciProductName").val(),id:e(".gucciProductCode").val(),price:e(".gucciProductPrice").val(),category:e(".gucciProductCategory").val(),variant:e(".gucciProductVariation").val(),position:e(".gucciProductPostion").val(),brand:e(".gucciProductBrand").val()}]}})},updateRemoveList:function(e){e.find(".baglist-item-selected").slideUp(J),e.find(".baglist-item-removed").slideDown(J),e.data("removed",!0);var t=e.data("unique-index");Ot.removeProductSummary(t,0,Ot.reloadPage)},getOrderSummaryForZipcode:function(e,t){var n=Q.data("items"),r=u.endPointAccess(e,n);r.done(function(e){Ot.updateEstimatedShippingOptions(e,Ot.closeZipCodeShippingSection),Ot.updateEstimatedTax(e,Ot.closeTaxTooltip)})},updateEstimatedShippingOptions:function(n,r){var i=n["shopping-bag"].data,s=i["shipping-methods"],o=e("#shopping-bag-order-details-shipping-methods").html(),u=t.compile(o),a=n["shopping-bag"].field_error_messages,f=a&&Object.keys(a).length>0;if(f){e.each(a,function(t,n){if(t==="shipping-zip-code"){var r=nt;Ot.showZipCodeError(n,e(z,r),e(X,r))}});return}Ot.removeZipCodeError(e(z,nt),e(X,nt)),st.each(function(){e(this).html(u(s))}),!f&&typeof r!="undefined"&&r()},updateEstimatedTax:function(n,r){var i=n["shopping-bag"].data,s=e("#shopping-bag-order-details-total").html(),o=t.compile(s),u=n["shopping-bag"].field_error_messages,a=u&&Object.keys(u).length>0;if(a){e.each(u,function(t,n){if(t==="payment-tax"){var r=R;Ot.showZipCodeError(n,e(z,r),e(X,r))}});return}Ot.removeZipCodeError(e(z,R),e(X,R)),e(".shopping-bag-estimated-total",tt).html(o(i)),s=e("#shopping-bag-order-details-tax").html(),o=t.compile(s),e(".shopping-bag-calculate-tax",tt).html(o(i)),!a&&typeof r!="undefined"&&r()},updateProductQuantity:function(e,t,n){var r={"unique-entry-number":e,qty:t},i=u.endPointAccess(d,r);i.done(function(){n()})},removeProductSummary:function(n,r,i){var s={"unique-entry-number":n,qty:r},o=u.endPointAccess(v,s);o.done(function(n){var r=n["shopping-bag"].data,s=r["shipping-methods"],o=e("#shopping-bag-order-details-shipping-methods").html(),u=t.compile(o),a=n["shopping-bag"];o=e("#shopping-bag-messages").html(),u=t.compile(o),e(".your-selections-messages",K).html(u(a)),st.each(function(){e(this).html(u(s))}),o=e("#shopping-bag-count").html(),u=t.compile(o),e(".count-products").html(u(r.itemCount)),e(".shopping-bag-product-count").html(u(r.itemCount)),o=e("#shopping-bag-order-details-subtotal").html(),u=t.compile(o),e(".shopping-bag-subtotal",tt).html(u(r)),o=e("#shopping-bag-order-details-duties").html(),u=t.compile(o),e(".shopping-bag-duties",tt).html(u(r)),o=e("#shopping-bag-order-details-vat").html(),u=t.compile(o),e(".shopping-bag-calculate-vat",tt).html(u(r)),o=e("#shopping-bag-order-details-total").html(),u=t.compile(o),e(".shopping-bag-estimated-total",tt).html(u(r)),o=e("#order-details-availability-item").html(),u=t.compile(o),ct.html(u(r)),Ot.bindTooltips(ct.find("a.view-more"));var f=n["shopping-bag"].field_error_messages,l=Object.keys(f).length>0;l&&e.each(f,function(t,n){if(t==="shipping-zip-code"||t==="payment-tax"){var r=nt;t==="payment-tax"&&(r=R),Ot.showZipCodeError(n,e(z,r),e(X,r))}});var c=r.isEmpty;c&&typeof i!="undefined"&&i()}),o.fail(function(e,t,n){console.error("The following error occurred: "+t,n)})},updateOrderSummary:function(n,r){var i=Q.data("items");if(r){if(!!r.is(".overlay-open"))return;var s=r.parents("li.baglist-item-summary");i={qty:0,"unique-entry-number":s.data("item-unique-index")}}var o=u.endPointAccess(l,i);o.done(function(r){var i=r["shopping-bag"].data,o=i["shipping-methods"],u=e("#shopping-bag-order-details-shipping-methods").html(),a=t.compile(u);st.each(function(){e(this).html(a(o))}),u=e("#shopping-bag-order-details-subtotal").html(),a=t.compile(u),e(".shopping-bag-subtotal",tt).html(a(i)),u=e("#shopping-bag-order-details-duties").html(),a=t.compile(u),e(".shopping-bag-duties",tt).html(a(i)),u=e("#shopping-bag-order-details-tax").html(),a=t.compile(u),e(".shopping-bag-calculate-tax",tt).html(a(i)),u=e("#shopping-bag-order-details-total").html(),a=t.compile(u),e(".shopping-bag-estimated-total",tt).html(a(i)),u=e("#order-details-availability-item").html(),a=t.compile(u),ct.html(a(i)),Ot.bindTooltips(ct.find("a.view-more"));var f=r["shopping-bag"].field_error_messages,l=Object.keys(f).length>0;l&&e.each(f,function(t,n){if(t==="shipping-zip-code"||t==="payment-tax"){var r=nt;t==="payment-tax"&&(r=R),Ot.showZipCodeError(n,e(z,r),e(X,r))}});if(s){s.attr("data-item-quantity",0);var c=0;e("li.baglist-item-summary",Q).each(function(){c+=parseInt(e(this).attr("data-item-quantity"),10)}),c===0&&(window.location.href=window.location.href)}!l&&typeof n!="undefined"&&n()}),o.fail(function(e,t,n){console.error("The following error occurred: "+t,n)})},reloadPage:function(){if(s.isIOSDevice()){e("body,html").scrollTop(0),e(document).scrollTop(0);var t;t=window.setTimeout(function(){location.reload()},200)}else location.reload(),e(window).scrollTop(0)},saveChangesOverlay:function(t){t.preventDefault();var n=e(".input-initials").length!=0,r=!1;if(n){var i=e(".input-initials").attr("minLength"),s=e(".input-initials").val().length,o=e(".initials-content._error"),a=e(".checkbox-periods").length,f=e(".active-periods-checkbox").is(":checked"),l=e(".dots-enabled").val(),c=i*2,h=i;l!="false"?a==0?i=c:f!="false"?i=c:i=h:i=h,i<=s?(o.addClass("hide"),r=!0):o.removeClass("hide")}if(!n||r){var p=t.data.$overlay,d,v=p.data("select-item");Tt&&(delete v["selected-initials"],delete v["selected-monogram-color-id"],delete v["style-initials-enable-periods"]),d=u.endPointAccess(m,v),d.done(function(){Ot.reloadPage(),e("html, body").animate({scrollTop:0},100)}),d.fail(function(e,t,n){console.error("The following error occurred: "+t,n)})}},removeProduct:function(t){t.preventDefault();var n=e(t.data.$productContainer[0]),r=e(".baglist-item-selected",n),i=e(".hero-shopping-bag").height(),s=r.offset().top-i;t.data.fromWishlist?(e(".removed-title",n).hide(),e(".moved-item-title",n).show(),r.slideUp(J).next(".baglist-item-removed").slideDown(J),e("body").animate({scrollTop:s},100)):e(".baglist-item-selected",n).slideUp(J)},removeProductOverlay:function(t){t.preventDefault();var n=e(t.data.$container[0]),i=e(".baglist-item-selected",n),s=e(".hero-shopping-bag").height(),o=t.data.top-s,u=t.data.index;e(".removed-title",n).show(),i.slideUp(J).next(".baglist-item-removed").slideDown(J),t.data.fromRemoveProductOverlay?(e("body, html").animate({scrollTop:o},100),r.close("#remove-overlay-"+u)):r.close("#overlay-"+u),mt[u].remove=!0,Ot.renderAvailabilityList()},saveForLater:function(t){var n=e(t.currentTarget);if(n.is(".overlay-open"))return;if(n.hasClass(T))n.removeClass(T);else{n.addClass(T),Ot.removeProduct(t),t.data.$productContainer.data("removed",!0),Ot.updateOrderItems(),Ot.updateOrderSummary(undefined,n);var r=e(t.data.$productContainer).data("unique-index");Ot.removeProductSummary(r,0,Ot.reloadPage),f.refreshMiniCart(hybris.CSRFToken)}},updateOrderItems:function(){var t=[],n={};Q.find("li.baglist-item-summary").each(function(){var n=e(this);n.data("removed")||t.push(e(this).data("data"))}),n.data={items:t,"shipping-zip-code":Q.data("shipping-zip-code"),"payment-tax":Q.data("payment-tax")},Q.data("items",n)},renderAvailabilityList:function(){e.each(yt,function(e,t){Ot.renderAvailabilityStatus(e,t)})},renderAvailabilityStatus:function(t,n){var r=" item",i=0,s,o,u=0,a=e(D+t,tt),f=a.find(P),l=a.find(H),c=e(B+t,ct);c.empty(),e.each(mt,function(e,r){r.remove===!1&&r.availability==t&&(s={availability:n.label,shipDateRange:Nt.formatDateRange(r.shipDateRange,"Month/Day"),title:r.title},o=parseInt(r.quantity,10),i+=o,u+=o*r.price,Ot.renderAvailabilityProduct(s,c))}),i!==1&&(r=" items"),f.text(i+r),l.text(dt+Nt.formatPrice(u))},renderAvailabilityProduct:function(e,n){var r=t.compile(ht.html()),i=r(e);n.append(i)},zipCodeBindEvents:function(){rt.on(g,Ot.getZipCodeData),lt.on(g,Ot.setZipCodeForTax),at.on(g,Ot.openTaxTooltip),ft.on(g,Ot.closeTaxTooltip)},getZipCodeData:function(){var t=e(z,tt).val();Q.data("shipping-zip-code",t),Ot.updateOrderItems(),Ot.getOrderSummaryForZipcode(h,Ot.closeZipCodeShippingSection)},setZipCodeForTax:function(){var t=e(z,R).val();t=t.toUpperCase(),Q.data("payment-tax",t),Ot.updateOrderItems(),Ot.getOrderSummaryForZipcode(p,Ot.closeTaxTooltip)},showZipCodeError:function(e,t,n){t.addClass(W).focus(),n.text(e).addClass(V)},removeZipCodeError:function(e,t){e.removeClass(W).focus(),t.text("").removeClass(V)},openTaxTooltip:function(e){e.preventDefault(),n.open(R)},closeTaxTooltip:function(){n.close(R)},renderShippingOption:function(e){var n={listName:e.listName,value:Nt.formatPrice(e.value)},r=t.compile(it),i=r(n);st.append(i)},renderTax:function(e){ut.text(U),gt.taxPercentage=e,xt.taxPercentage=e,Ot.closeTaxTooltip()}};return{load:function(){Ot.init()}}});
