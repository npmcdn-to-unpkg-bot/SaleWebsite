define(["jquery","overlay","os"],function(e,t,n){function y(){if(!Modernizr.history)return!1;var e=location.pathname+location.search;history.replaceState(null,document.title,e+"#!/gcsh"),history.pushState(null,document.title,e),window.addEventListener("popstate",function(n){return!1===x()?!0:("#!/gcsh"===location.hash&&(history.replaceState(null,document.title,e+"#!/gcsh"),history.pushState(null,document.title,e),t.open(r)),n.preventDefault())},!1)}function b(){e(u,i).on("click",function(t){t.preventDefault(),g={},e(s,i).trigger("reset"),!1===x()&&e(window).off("beforeunload",T),h.forEach(function(t){e(':input[name="'+t+'"]').selectric("refresh")}),e(o,i).attr("disabled","disabled"),e(this).hide().parent().hide()})}function w(){var t=[];e(":input, "+f,i).on("input change",function(){var t=e(this);g[this.name]=!0,e(window).on("beforeunload",T),t.is("select")&&Modernizr.touch&&S(t)}),h.forEach(function(e){t.push(':input[name="'+e+'"]')}),e(t.join(),i).on("selectric-before-open",function(){e(u).parent().css("display","inline-block").end().show(),e(o).removeAttr("disabled")})}function E(){y(),w(),b(),e(':input[type="text"], :input[type="checkbox"]',i).on("focus change",function(){e(u,i).parent().css("display","inline-block").end().show(),e(o,i).removeAttr("disabled")}),l.on("click",function(e){e.preventDefault(),t.close(r)}),e(o,i).on("click",C),a.on("click",function(){t.close(r),e(o,i).click()})}function S(t){e("option:selected",t).val()==="-1"?t.addClass("gold"):t.removeClass("gold")}function x(){return Object.keys(g).length>0}function T(e){return!1===x()?"":(e=e||window.event,e&&(e.returnValue=p),p)}function N(e){var t=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;return t.test(e)}function C(){var n=e(c,i);k(),e(".error-message",i).hide(),n.removeClass("error");if(""===n.val()||!N(n.val()))e(".error-message",n.parent()).text(n.data("message")).show(),n.addClass("error"),n.trigger("focus"),t.close(r)}function k(){e(d).find("."+v).addClass(m)}function L(){e("#accountSettingsForm").submit(function(){return e(window).unbind("beforeunload"),!0}),e(a).on("click",function(){e(window).unbind("beforeunload"),e("#accountSettingsForm").submit()}),e(".account-settings-form-group").last().addClass("last")}var r="#cancel-changes-overlay",i=".account-settings",s=".account-settings-inner-wrapper form",o=".account-settings-button-save-changes",u=".account-settings-cancel-changes",a=e(".account-settings-button-save-continue"),f=".custom-select-parent select",l=e(".account-settings-button-go-back"),c=".account-settings-email",h=["titleCode","account-settings-country","month","day","year"],p="You are leaving the page without saving your settings.  If you continue you will  loose all the changes you made.",d=".account-settings-form-content-container .selectricWrapper.selectric-error",v="selectric",m="error",g={};return{load:function(){n.isMobileDevice(),E(),k(),L()}}});
