define(["dispatcher","jquery","header","os"],function(e,t,n,r){function N(){S.on("click",".overlay-open:not(.personalization-custom-overlay)",M).on("click",".overlay-close",D).on("click","."+u,D).on("click",".overlay-content",F),t("html").bind("keyup"+i,q),t(".overlay-slider-next",c).on("click",L),t(".overlay-slider-prev",c).on("click",A),t(".item-info").on("click",".trigger-info",k)}function C(e){var n=t.grep(S.find('[data-module="'+e+'"]'),function(e){return e.id==m});return typeof n[0]!="undefined"?n[0].id:""}function k(e){e.preventDefault(),t(".hidden-info").slideToggle("slow")}function L(e){var n=t(h,c),r=n.next();n.fadeOut(200,function(){n.removeClass(l),r.fadeIn(500,function(){r.addClass(l),e!==undefined&&e()})})}function A(){var e=t(h,c),n=e.prev();e.fadeOut(200,function(){e.removeClass(l),n.fadeIn(500,function(){n.addClass(l)})})}function O(e){t(c+" > div:first",e).addClass(l).siblings().removeClass(l)}function M(e){var n=t(this).attr("class"),i=t(this).attr("href");typeof i=="undefined"&&(i=t(this).attr("data-href")),!t(this).hasClass(s)&&(!t(this).hasClass("play")||!r.supportsTouch())&&_(i,e,n),t(this).hasClass("play")||I(e),t(window).trigger("resize")}function _(n,r,i){var s=t(n),u=t(),a=t(window).scrollTop(),l=t("#page"),c=t(n).closest(".carousel-inner");w=a,c.length>0&&c.addClass("transform-disable"),typeof r!="undefined"&&typeof r.target!="undefined"&&(u=t(r.target)),s.trigger("overlay.open");if(s.length){p&&typeof u.data("ios-no-transitions")!="undefined"&&!t("body").hasClass("page-gucciCartPage")&&(y=!0,s.find(".overlay-content").css("transition","none")),p&&!s.hasClass("header-nav-ship-to-overlay-wrapper")&&t(".overlay-background").fadeIn(800),typeof i!="undefined"&&i.indexOf("signin-overlay")>=0&&(t("#form-create-account").find("div#recognized-email-overlay").css("display","none"),t("#form-create-account").find("div.form-create-account-content-padding").css("display","block")),s.addClass(o).fadeIn(d);var h=!!navigator.userAgent.match(/firefox/i),v=!!window.ActiveXObject,g=document.all&&!window.atob;if(v===!0||t(n).hasClass("article-photo-gallery"))t("#page").css({position:"absolute"}),g===!0&&t(".overlay").addClass("fix-trasp");S.addClass(f);var b=parseInt(l.css("margin-top"),10),T=b-a;l.css("margin-top",T+"px"),x&&!t("#"+m)&&s.addClass("prevent-document-scroll"),e.fireCallbacks(E.open,s),hybris.fav.save(n,u),P(n)}}function D(e){var n="#"+t(this).closest(i+"."+o).attr("id");j(n),I(e),H(n),hybris.fav.restore(n),S.removeClass(a)}function P(e){var n=t(e+" form");if(n.length==0)return;var r=g[e]=[],i;n.each(function(){t("select,input",this).each(function(){i=t(this),r.push({$ptr:i,val:i.val()})})})}function H(e){var n=t(e+" form"),r=g[e],i,s;if(n.length==0||typeof r=="undefined")return;for(var o=0;o<r.length;o++)i=r[o],i.$ptr.val(i.val),i.$ptr.is('input[type="checkbox"]')?i.val=="on"||i.val=="true"||i.val=="yes"?i.$ptr.prop("checked",!0):i.$ptr.prop("checked",!1):i.$ptr.is("select")&&(s=t('option[value="'+i.val+'"]',i.$ptr).index(),i.$ptr.prop("selectedIndex",s).selectric("refresh"));delete g[e]}function B(r,i){if(s==""||s=="null")var s=!1;if(s||r.hasClass("no-transition")){var u=t(i).closest(".carousel-inner");r.hide().removeClass(o);var s=!1;u.length>0&&u.removeClass("transform-disable"),p&&!r.hasClass("header-nav-ship-to-overlay-wrapper")&&(t(".overlay-background").hide(),r.css("height","auto")),r.trigger("overlay.afterClose"),n.closeNav(r)}else p&&!r.hasClass("header-nav-ship-to-overlay-wrapper")&&r.hasClass(o)&&t(".overlay-background").fadeOut(d),r.fadeOut(d,function(){t(this).removeClass(o);var e=t(i).closest(".carousel-inner");e.length>0&&e.removeClass("transform-disable"),r.trigger("overlay.afterClose"),p&&r.css("height","auto"),n.closeNav(r)});O(i),S.removeClass(f),t(window).scrollTop(w);if(!t(i).hasClass("social-overlay")||!t(i).hasClass("article-photo-gallery"))T.removeAttr("style"),S.scrollTop(b);e.fireCallbacks(E.close,r)}function j(e){t(".paused").removeClass("paused");var n=t(e),r=t(e).find("object.BrightcoveExperience");n.trigger("overlay.close"),r.length>0,n.length&&(B(n,e),p&&n.find("input, textarea, select").off("focus.overlayform blur.overlayform"))}function F(e){e.stopPropagation()}function I(e){e&&e.preventDefault&&e.preventDefault()}function q(e){R(e)&&D()}function R(e){return e.which===27}var i=".overlay",s="_disabled",o="_active",u="overlay",a="header-countries",f="overlay-lock",l="_overlay-slider-active",c=".overlay-slider-inner",h="."+l,p=r.isIOSDevice(),d=400,v="overlay",m="merging-basket-overlay",g={},y,b,w,E={open:[],close:[]},S=t("body"),x=t("html").hasClass("touch"),T=t("#page");return{load:function(){N()},open:function(e){_(e)},close:function(e){j(e)},onOpen:function(e){E.open.push(e)},onClose:function(e){E.close.push(e)},prevSlideOverlay:function(){A()},nextSlideOverlay:function(e){L(e)}}});
