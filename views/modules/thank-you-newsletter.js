define(["jquery","formEndpointValidation","ajaxConfig","overlay","os","imageLoader"],function(e,t,n,r,i,s){function c(){f.on("submit",d),l.on("submit",m),l.prop("action",o),t.newInstance(l,v),s.loadImage(l),e(".form-overlay-content-newsletter").on("click",g),e("select",l).on("change",h)}function h(){var t=e(this),n=t.val(),r=n>0||isNaN(n);r?t.removeClass("gold"):t.addClass("gold")}function p(e){var t=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;return t.test(e)}function d(t){t.preventDefault();var n=e("#email-updates"),i=n.closest("form"),s=n.val();typeof n.data("placeholder")=="undefined"&&n.data("placeholder",n.attr("placeholder"));if(!p(s))return n.attr("placeholder",n.data("error-message")),n.val(""),i.addClass("newsletter-invalid-email-error"),!1;var o=e.ajax({url:u,type:a,data:jQuery.param({email:s,CSRFToken:hybris.CSRFToken}),dataType:"json"});o.done(function(){e("input:text",l).val(""),e("#email-updates",f).val(""),e("select",l).find('option[value="0"]').prop("selected",!0),e("select",l).selectric("refresh"),e("input:checkbox",l).not("checked-at-default").removeAttr("checked"),e(".checked-at-default",l).prop("checked",!0),r.open("#thank-you-newsletter"),e(".newsletter-email").text(s),e(".newsletter-email-input").val(s),i.removeClass("newsletter-invalid-email-error"),n.val(""),n.attr("placeholder",n.data("placeholder"))}),o.error(function(){})}function v(){r.close("#thank-you-newsletter")}function m(){dataLayer.push({event:"newsletterSubscribe",email:e("#thank-you-newsletter .newsletter-email").html()}),v()}function g(){e(".selectricWrapper",e(".form-overlay-content-newsletter")).filter(".selectricOpen").find("select").each(function(){e(this).selectric("close")})}var o=n.getRemoteService("THANK-YOU-NEWSLETTER"),u=n.getRemoteService("SIGN-UP-UPDATES"),a=n.mainSubmitMethod(),f=e("#thank-you-newsletter-form"),l=e("#thank-you-newsletter-overlay");return{load:function(){c()}}});
