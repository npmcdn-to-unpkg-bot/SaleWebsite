define(["jquery","overlay","viewport","breakpoints","formEndpointValidation","ajaxConfig","googleMaps","googleMapsApi"],function(e,t,n,r,i,s,o,u){function y(){e("input",m).on("focus",function(){e("#time-preference",m).selectric("close"),e("#title",m).selectric("close")})}function b(){var t=e(".find-in-store-email-form-wrapper"),n=e(".find-in-store-email");t.toggleClass("show"),n.toggleClass("show"),t.hasClass("show")&&t.find("form").is(":not(:visible)")&&(t.find(".stores-map-email-confirmation-text, .stores-map-email-error-text").hide(),t.find("form").show())}function w(){f.on("click",".stores-map-select-cta",A),f.on("click",".find-in-store-change-cta",O),f.on("click",".schedule-call-back-success-edit",L),e(".find-in-store-mobile-button",f).on("click",S),l.on("change",function(e){P(e)}),f.on("overlay.close",L);var t=e("#find-in-store-call-back-form",f);t.prop("action",a),i.newInstance(t,k),y(),e(".button-email.find-in-store-email").on("click",b),E(),l.find(".selectricItems").addClass("size-scrollable")}function E(){e(".find-in-store-email-submit",f).on("click",function(t){t.stopPropagation(),t.preventDefault(),e("#find-in-store-send-email-form",f).fadeOut(function(){e(".find-in-store-email-confirmation-text").fadeIn()})})}function S(){e(".stores-map-index-search-input-submit").trigger("click")}function x(t){var n=t.data("telephone"),i=t.data("distance"),s=e(".find-in-store-results-details",f),o=e(".find-in-store-call-cta .number",f);e(".stores-map-card",s).remove(),s.prepend(t.clone(!0));if(r.is("small")||r.is("medium"))i=e(".distance-value",t).html().replace(/[^0-9\.]/g,""),e(".distance-selected-card .number",s).html(i);e(".find-in-store-call-back-phone-number",f).html(n),o.html(n),o.parent().attr("href","tel:"+n),N(t)}function T(e,t,n){var r={labelContent:""+t,labelSize:new u.Size(30,45),labelAnchor:new u.Point(15,35),labelVisible:!0,icon:{origin:new google.maps.Point(0,0),url:g,scaledSize:new google.maps.Size(30,45)},optimized:!1,labelInBackground:!0,labelClass:"map-column-icon-label",zIndex:1,labelZIndex:1};o.addMarkerFromLatLng(name,e,function(){},function(){},n,r,function(){},function(){})}function N(e){var t=e.data("latitude")+","+e.data("longitude"),n=new u.LatLng(e.data("latitude"),e.data("longitude")),r;r=o.buildMap("find-in-store-results-map",n),T(t,e.data("id"),r),C(e,r),r.set("zoomControl",!1),r.set("draggable",!1),r.set("disableDoubleClickZoom",!0),r.set("scrollwheel",!1);var i=[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}];r.set("styles",i)}function C(t,n){var r=[],i,s;e.each(t,function(){s=new google.maps.LatLng(e(this).data("latitude"),e(this).data("longitude")),r.push(s)}),i=new google.maps.LatLngBounds;for(var o=0;o<r.length;o++)i.extend(r[o]);n.fitBounds(i)}function k(t){e(".schedule-call-back-success-user-name",f).text(t.data.title+" "+t.data["first-name"]),e(".schedule-call-back-success-phone",f).text(t.data["phone-number"]),e(".schedule-call-back-success-email",f).text(t.data.email),e(".schedule-call-back-success-date",f).text(t.data.date),e(".schedule-call-back-success-time-preference",f).text(t.data["time-preference"]),v.fadeOut(400),p.fadeOut(400,function(){d.fadeIn(400)})}function L(){v.fadeIn(400),(p.is(":visible")||d.is(":visible"))&&p.fadeIn(400,function(){d.fadeOut(400)})}function A(t){var n=e(this).prev().clone(!0),i=e.trim(l.find("option:selected").text());h.fadeOut(400,function(){if(r.is("small")||r.is("medium")){var t=e("#find-in-store-overlay"),i=e(".find-in-store-header",t).height(),s=e(".find-in-store-product-selected-wrapper",t).height()+44,o=e(".find-in-store-results-user-actions",t).height(),u=i+s+o+100;f.animate({scrollTop:u},500)}p.fadeIn(400,function(){x(n)})}),l.addClass("hide"),c.removeClass("hide"),c.find("span").text(parseFloat(i)),_(n),P(t)}function O(e){P(e),p.fadeOut(400,function(){h.fadeIn(400)}),M()}function M(){l.removeClass("hide"),c.addClass("hide")}function _(t){var n=e(".stores-map-card",p),r={};r.name=t.data("name"),r.country=t.data("country"),r.city=t.data("city");var i=[];i.push(r);var s={};s.stores=i,dataLayer.push(s)}function D(){e("html").hasClass("iOS")&&r.is("standard")?(f.hasClass("_active")?f.removeClass("prevent-document-scroll"):f.on("overlay.open",function(){setTimeout(function(){f.removeClass("prevent-document-scroll")},200)}),e(".stores-search-column",f).addClass("prevent-document-scroll")):(f.off("overlay.open").addClass("prevent-document-scroll"),e(".stores-search-column",f).removeClass("prevent-document-scroll"))}function P(e){e&&e.preventDefault&&e.preventDefault()}var a=s.getRemoteService("FIND-IN-STORE-CONTACT-ENDPOINT"),f=e(".find-in-store-overlay"),l=e(".product-detail-size-select",f),c=e(".find-in-store-product-size",f),h=e(".stores-map-wrapper",f),p=e(".selected-store-content",f),d=e(".schedule-call-back-success",f),v=e(".find-in-store-header, .find-in-store-product-selected-wrapper, .find-in-store-disclaimer",f),m=e(".fis-form-container",f),g="/_ui/responsive/theme-gucci/images/map-marker-normal.png";return e("html").hasClass("retina")&&(g="/_ui/responsive/theme-gucci/images/map-marker-normal-2x.png"),{load:function(){w(),D(),r.change(D)}}});
