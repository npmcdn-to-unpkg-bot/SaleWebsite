define(["jquery","jZoom","breakpoints","os","viewport","tweenMax"],function(e,t,n,r,i){function Z(e){return e.originalEvent.targetTouches?e.originalEvent.targetTouches[0]:e}function et(t){var n=e(t),r=!1,i=0,s=0,o=0,u=0;n.on("touchstart mousedown",function(e){e.preventDefault();var t=Z(e);o=i=t.pageX,u=s=t.pageY,r=!0,n.trigger("Touchstarted"),setTimeout(function(){o===i&&!r&&u===s&&n.trigger("Tap")},200)}),n.on("touchend mouseup touchcancel",function(e){e.preventDefault(),r=!1,n.trigger("Touchended")}),n.on("touchmove mousemove",function(e){e.preventDefault();var t=Z(e);i=t.pageX,s=t.pageY,r&&n.trigger("Swiping")})}function tt(){e(g).smartZoom("destroy"),e(g).smartZoom(),e(g).smartZoom("zoom",U)}function nt(){e(s).addClass(p),e(u).removeClass("closed"),e(A).removeClass("closed"),I=i.get().scrollTop,setTimeout(function(){tt()},120)}function rt(){e(g).smartZoom("zoom",-U),e(s).removeClass(p),e(u).addClass("closed"),e(A).addClass("closed"),e(window).scrollTop(I)}function it(t){var n=0,r=0;switch(t.target.id){case"leftPositionMapHover":n=R;break;case"rightPositionMapHover":n=-R;break;case"topPositionMapHover":r=R;break;case"bottomPositionMapHover":r=-R}e(".imageFullScreen").smartZoom("pan",n,r)}function st(){var t=e(this);t.hasClass(b)&&(D=setInterval(ut,q)),t.hasClass(E)&&(P=setInterval(at,q)),t.hasClass(x)&&(H=setInterval(ft,q)),t.hasClass(N)&&(B=setInterval(lt,q))}function ot(){var t=e(this);t.hasClass(b)&&clearInterval(D),t.hasClass(E)&&clearInterval(P),t.hasClass(x)&&clearInterval(H),t.hasClass(N)&&clearInterval(B)}function ut(){e(y).trigger("click")}function at(){e(w).trigger("click")}function ft(){e(S).trigger("click")}function lt(){e(T).trigger("click")}function ct(){var t=e(o).find(d).attr("src"),n=[b,E,x,N];e(u).addClass("touch"),e(".close-zoom-x").length===0&&e(h).appendTo(s),e(A).delay(1e3).fadeIn(500),e(k).delay(1e3).fadeIn(500),e(L).delay(1e3).fadeIn(500),e(C).on("click",it),n=n.join(","),e(n).on("mouseenter.interval",st).on("mouseleave.interval",ot),e(a).before('<div class="close-zoom-x"></div>'),e(u).off("mousedown",rt),e(f).on("click",rt),e(u).on("Tap",rt),e(".exclusive-product").length>0&&e(u).addClass("exclusive-zoom"),e(o).hasClass("zoom-in-white")?e(u).addClass(O):e(u).removeClass(O),e(v).attr("src",t),e(g).smartZoom({containerClass:"zoomableContainer"}),e(u).addClass("closed")}function ht(t){V=t,F?(e(o).addClass("touchZoom"),e("body").on("click.productzoom",o,nt),e("body").on("click",".touchZoom",function(){e(v).attr("src",e(this).find(d).attr("src"))})):(V.on("click",vt),V.mousemove(function(e){G=e.pageX,Y=e.pageY})),ct()}function pt(){M=e(window).width(),_=e(window).height(),F===!1?V.on("click",vt):(e(o).on("click",nt),e(u).off("mousedown",rt)),e(m).width(M).height(_)}function dt(){$.mousemove(function(t){var n=new Image,r=0,i,s,o,u,a,f,l,c;!K&&!Q?(n.src=e(".zoom-small .zoom-img",$).attr("src"),K=n.width,Q=n.height):(i=e(this).offset(),s=t.pageX-i.left,o=t.pageY-i.top,s<e(this).width()&&o<e(this).height()&&s>0&&o>0&&e(".zoom-large",$).show(),e(".zoom-large",$).is(":visible")&&(n.src=e(".zoom-small .zoom-img",$).attr("src"),u=Math.round(s/e(".zoom-small",$).width()*K-e(".zoom-large",$).width()/2)*-1,a=Math.round(o/e(".zoom-small",$).height()*Q-e(".zoom-large",$).height()/2)*-1,f=u+"px "+a+"px",l=s-e(".zoom-large",$).width()/2,c=o-e(".zoom-large",$).height()/2,e(".zoom-large",$).css({left:l,top:c,backgroundPosition:f}),J.is(":visible")&&j===!0&&(c<=-(_/2)?r=-c/2:c<=-(3*_/4)?r=-c/4:r=c,TweenMax.to(J,.2,{css:{top:r,left:X?-l/2:z},onComplete:function(){J.hide(),e(".zoom-large",$).css("background-image","url("+n.src+")")}}),j=!1)))})}function vt(){function d(e){e.css("position")=="fixed"&&(e.addClass("wasFixed"),e.css({position:"relative"}))}function v(e){e.css("position")=="relative"&&e.is(".wasFixed")&&e.css({position:"relative"})}function m(){$.find(".zoom-content").css({display:"table"}),e(".zoom-small",$).css({opacity:0}),dt(),$.on("click",y),M>767&&J.attr("src",J.data("src_standard_retina"))}function g(){$.fadeOut(300,function(){e(".zoom-large").css("background-image","none"),J.hide()}),j=!0,$.off("click"),t.closest(".carousel-inner").removeClass("transform-disable")}function y(){if(!J.is(":visible")){var n=e(".zoom-large",$),s=n.position(),o=s.top,u=s.left,a=e(".zoom-large",$).css("background-position").split(" "),f=o+parseInt(a[1].replace("px",""),10)+J.height(),l=u+parseInt(a[0].replace("px",""),10)+J.width();J.css({top:f+"px",left:l+"px",marginLeft:0})}v(t.parents(".lastItem")),$.find(".zoom-content").hide(),J.show(),TweenMax.to(J,.5,{css:{scale:1,left:r,top:i,width:V.width(),marginLeft:0},onComplete:g})}var t=e(this),n,r=t.offset().left,i=t.offset().top-e(window).scrollTop(),s=new Image,o=t.width()/2,u=t.height()/2,a=t.offset(),f=G-a.left,l=Y-a.top,c=0,h=0,p;$=t.parents(".zoom-in").find(".overlay-zoom-content"),J=e(".zoom-item-clone",$),n=e(".zoom-img",$),s.src=n.attr("src"),X=s.width,p=mt(X,V.width()),t.closest(".carousel-inner").addClass("transform-disable"),d(t.parents(".last-item")),J.css({left:r,top:i}),$.show(),J.show(),f<=o/2?c=f+o*2:f<=o?c=f+o/2:f<=o+o/2?c=f-o/2:c=f-o*2,l<=u/2?h=l+u*2:l<=u+u/2?h=l-u/2:(h=l-u*4,f>=o/2&&f<=o+o/2&&(c=f)),X>M?(z=c*100/M+"%",W=0):(z="50%",W=-V.width()/2),TweenMax.to(J,.5,{css:{scale:p,left:z,top:h*100/_+"%",width:V.width(),marginLeft:W},onComplete:m})}function mt(e,t){return Math.round(e/t*100)/100}var s="body",o=".zoom-in",u=".overlay-zoom",a=".content-zoom",f=".close-zoom-x",l='<div class="control-move"><div id="topPositionMapHover"></div><div id="leftPositionMapHover"></div><div id="rightPositionMapHover"></div><div id="bottomPositionMapHover"></div></div>',c='<div id="zoom-controller" class="zoom-controller"><div id="topPositionMap" class="topPositionMap"></div><div id="leftPositionMap" class="leftPositionMap"></div><div id="rightPositionMap" class="rightPositionMap"></div><div id="bottomPositionMap" class="bottomPositionMap"></div></div>',h='<div class="overlay-zoom">'+c+'<div class="content-zoom"><img id="imageFullScreen" src=""></div></div></div>'+l,p="zoom-alone",d=".overlay-zoom-content img.zoom-img",v=".overlay-zoom img",m=".zoomableContainer",g="#imageFullScreen",y="#topPositionMapHover",b="#topPositionMap",w="#leftPositionMapHover",E="#leftPositionMap",S="#rightPositionMapHover",x="#rightPositionMap",T="#bottomPositionMapHover",N="#bottomPositionMap",C="#topPositionMapHover, #leftPositionMapHover, #rightPositionMapHover, #bottomPositionMapHover",k="#zoom-controller",L="#zoom-controller div",A=".control-move",O="zoom-in-white-bg",M=e(window).width(),_=e(window).height(),D=0,P=0,H=0,B=0,j=!0,F=Modernizr.touch,I=0,q=150,R=300,U=.8,z=0,W=0,X=0,V=null,$=null,J=null,K=0,Q=0,G,Y;return{load:function(){ht(e(".zoom-item")),n.change(pt),et(u),e(document).on("zoomLoaded",function(){e(".zoom-in").addClass("active"),e(".zoom-in._active-slide").find("img").addClass("active"),e(".slick-active .zoom-in").find("img").addClass("active")}),e(window).on("resize.zoom",function(){M=e(window).width(),_=e(window).height(),e(m).width(M).height(_),tt()})},zoomUpdate:function(e){ht(e)}}});
