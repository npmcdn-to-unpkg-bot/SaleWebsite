define(["jquery","formEndpointValidation","ajaxConfig","overlay","os","handlebars","datePickerModule"],function(e,t,n,r,i,s,o){function k(){if(e("html").hasClass("tablet")&&i.isIOSDevice()){var n;e("input",E).on("blur",function(){clearTimeout(n),n=setTimeout(function(){window.scrollTo(document.body.scrollLeft,document.body.scrollTop)},100)}),e("input",E).on("focus",function(){clearTimeout(n)})}e(c,E).on("click",O),x.focus(D),x.focusout(P),E.prop("action",y),t.newInstance(E,A,A),e(l,E).keydown(L),e(a).on("click",B),M(),_(),H(),o.init()}function L(){var t=e(f,E);e(l,E).limiter(400,t)}function A(t){switch(t.status){case"ok":N.fadeOut({done:function(){var n=s.compile(e("script#sa-confirmation-list").html()),r=e("ul.sa-confirmation-list",T),i=s.compile(e("script#sa-confirmation-name").html()),o=e(".sa-info-title-name",T);r.html(n(t.data)),o.html(i(t.data)),C.fadeIn(),e(h,r).on("click",function(e){e.preventDefault(),C.fadeOut({done:function(){N.fadeIn()}})})}});break;case"validationError":return!1}}function O(){e(p,E).val(""),e(m,E).find('option[value=""]').prop("selected",!0),e(m,E).selectric("refresh"),e(v,E).val(w),e(d).show(),M(),L()}function M(){b=E.data("country"),S.find('option[value="'+b+'"]').prop("selected",!0),S.change(),S.selectric("refresh")}function _(){w=e(v,E).val()}function D(){x.parent().addClass("focus")}function P(){x.parent().removeClass("focus")}function H(){r.onClose(function(t){e(":focus").trigger("blur"),t.attr("id")===g&&(C.css("display","none"),N.css("display","block"),O())})}function B(){e(".selectricWrapper",E).filter(".selectricOpen").find("select").each(function(){e(this).selectric("close")})}var u=".schedule-appointment-form",a=".schedule-appointment-overlay-content",f=".sa-form-characters-left-number",l=".sa-form-purpose-visit",c=".sa-button-done",h=".sa-edit-link",p=".sa-form-field-name",d=".sa-confirmation-item-description-purpose",v=".date-form-input",m="select",g="schedule-appointment-overlay",y=n.getRemoteService("SCHEDULE-APPOINTMENT-ENDPOINT"),b,w,E=e(u),S=e("#country-code",E),x=e(".sa-form-purpose-visit"),T=e("."+g),N=e(".schedule-appointment-form-slide",T),C=e(".schedule-appointment-confirmation-slide",T);return function(e){e.fn.extend({limiter:function(t,n){function r(e,n){var r=e.value.length;r>t&&(e.value=e.value.substr(0,t),r=t),n.html(t-r)}e(this).on("input",function(){r(this,n)}),r(e(this)[0],n)}})}(e),{load:function(){e("#"+g).on("overlay.open",k)}}});
