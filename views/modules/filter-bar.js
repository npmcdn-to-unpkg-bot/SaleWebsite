define(["jquery","breakpoints","viewport","ajaxLoader","imageLoader"],function(e,t,n,r,i){function F(){z(),q()}function I(){e(window).on("scroll",R),e(window).on("resize",Z),w.on("mouseenter click",o,X),k.on("click",K),E.on("click",ut),S.on("click",ut),x.on("click",et),L.on("click",Y),e(v).on("mouseenter click",tt),e(v).on("mouseleave",nt),e(".filter-sort p").hover(X),w.on("scrolledTop",W)}function q(){(t.is("medium")||t.is("small"))&&E.index()===0?(E.children("a").html(E.data("small-text")),E.appendTo(e(h))):t.is("standard")&&E.index()!==0&&E.parent().prepend(E)}function R(){t.is("standard")&&e(".selectric-sort-select").removeClass("selectricOpen"),n.scrollDown(z,!0),n.scrollUp(W,!0)}function U(){var t=0;return e(v+":visible").each(function(){t+=e(this).height()}),t+=e(h).height(),t}function z(){var t=e(window).scrollTop(),n=U();j||t>=D&&t+n>t+window.innerHeight&&b.addClass(c),V()}function W(t){var n=e(window).scrollTop(),r=U();j||n<=D&&n+r<n+window.innerHeight&&b.removeClass(c),n<=_?b.removeClass(l):V(),clearInterval(B),B=setInterval(function(){typeof t!="undefined"&&W()},0)}function X(){t.is("standard")&&setTimeout(function(){e(s).removeClass(l)},275)}function V(){t.is("standard")&&n.get().scrollTop>=_&&e(s).addClass(l)}function $(){n.resize(J)}function J(){_=e(".content").position().top,D=e(".filter-bar-container").position().top,e(s).removeClass(l),q()}function K(t){var n=e(this);H=!0,n.toggleClass(u),Q(n);var r=e("a",n);if(r.length==1&&n.is("li")){location.href=r.attr("href");return}st(t)}function Q(t){var n=e(h+" ."+u+":not("+v+")").length;if(t!==undefined&&t.length){var r=t.parent().children("."+u).length,i=t.closest(v+"._hover").find(p);r>0?i.text("("+r+")"):i.text("")}n>0?(C.text("("+n+")"),E.show(),S.addClass(y),x.parent().addClass(y),T.addClass("filter-applied"),Z(),N.addClass("filter-applied")):(C.text(""),e(p).text(""),E.hide(),S.removeClass(y),x.parent().removeClass(y),T.removeClass("filter-applied"),N.removeClass("filter-applied"))}function G(t){e(h+" ."+u).removeClass(u),Q(undefined),e(this).hasClass("reset-filter-btn")?rt(e(this)):rt(e(this).children("a")),st(t)}function Y(){e(this).toggleClass(u),t.is("standard")||(A.toggleClass(a),A.parent().toggleClass(f),e(v).first().addClass("_hover _active")),Z(),e(document).on("click",et)}function Z(){if(t.is("small")&&typeof T!="undefined"&&typeof S!="undefined"){var e=T.outerWidth()+15;S.css("right",e+"px")}}function et(t){var n=e(".filter-attributes-nav");if(!n.is(t.target)&&n.has(t.target).length===0||T.is(t.target)||x.is(t.target))A.removeClass(a).parent().removeClass(f),L.removeClass(u),e(v).removeClass(u+" _hover"),e(".search-result").removeClass("prevent-document-scroll"),e(document).off("click",et);st(t)}function tt(n){var r=e(this);clearTimeout(P),r.siblings().removeClass(u),e(".selectric-sort-select").removeClass("selectricOpen"),H||e(h+" "+d).removeClass(a),n.type==="click"&&H===!1&&t.is("standard")?r.toggleClass(u).find(d).toggleClass(a):r.addClass(u).find(d).addClass(a),H=!1}function nt(){P=setTimeout(function(){e(v).removeClass(u)},600)}function rt(e){var t=e.data("url"),n=[];n.push(it),r.loadJson(t,m,e,g,!1,n)}function it(){i.loadImage(e(".product-tiles-grid"))}function st(e){e&&e.preventDefault&&e.preventDefault()}function ot(){var t=location.search,n=t.substring(0,7)==="?filter";n&&e("html, body").animate({scrollTop:b.offset().top-b.height()*2},"slow")}function ut(){var t=e(this);t.is("a")||(t=e("a",t)),t.attr("href")!==undefined&&(location.href=t.attr("href"))}function at(){var t=e(".prevent-document-scroll li._active:eq(0)");t.length!=1&&(t=e(".prevent-document-scroll li:eq(0)")),t.length==1&&t.parents(".prevent-document-scroll").addClass("_open")}var s=".filter-bar.filter-fixed",o=".filter-category, .filter-attributes-sort",u="_active",a="_open",f="_open-attributes",l="filter-collapsed",c="filter-fixed",h=".filter-menu",p=".filter-count",d=".dropdown",v=".filter-item",m="product-tiles-grid-load-content",g="product-tiles-grid-item",y="_filtered",b=e(".filter-bar"),w=e("body"),E=e(".filter-reset-btn"),S=e(".reset-filter-btn"),x=e(".filter-close-btn a"),T=e(".close-filter-btn"),N=e(".reset-divider"),C=e(".filter-total-count"),k=e(".filter-menu .dropdown li"),L=e(".filter-expander"),A=e(".filter-attributes-sort"),O=e(".content"),M=e(".filter-bar-container"),_=O.length?O.position().top:0,D=M.length?M.position().top:0,P=null,H=!1,B,j=e("html").hasClass("iOS7")&&e("html").hasClass("iPad");return{load:function(){F(),I(),$(),Q(),at(),j&&(w.addClass("ios-sticky-bar"),b.addClass(c)),ot()}}});
