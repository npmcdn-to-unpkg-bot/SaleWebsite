define(["jquery","ajaxLoader","view360","handlebars","imageLoader","addProductShoppingBag","savedItems","styleSelector","slickCarousel","breakpoints","video","overlay","loader","slick"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){function j(e){for(var t in e)if(t===d)return e[t]}function F(){if(typeof _!="undefined")return!0}function I(){e(g).show(),i.loadImage(e("body")),h.loadModules(e(".shop-the-look-items-container")),setTimeout(function(){e("body").removeClass("overlay-lock"),e(".spinner-wrapper").removeClass("global-standard-spinner").hide()},500)}function q(){L||(e("body").off("click.videocomponent",".play").off("overlay.close",".mobile-share-overlay").off("videos.ready"),e(document).unbind(".videocomponent"),l.load(),require.onResourceLoad=function(e,t){require.undef(t.name)},L=!0)}function R(e,t){e.find(".carousel-current").text(t),e.find(".carousel-total").text(H)}function U(t,n,r){var i=t.find(".shop-the-look-carousel-available"),s;t.find(".carousel-slide").remove(),s=C(n),t.find(y).append(s),e(y,i).on("beforeChange",q),r==="update"&&I()}function z(e,t){var n;e.find(".stl-item-details").html(""),n=k(t),e.find(".stl-item-details").append(n)}function W(){if(e(this).hasClass("prevent-more-submit"))return;var t=e(this),n=t.closest(".stl-item-details").find(".add-to-shopping-bag-form");e(this).addClass("prevent-more-submit"),s.addToShoppingBag(n)}function X(t,n){n.inStock?(e(v).eq(n.index).find(".styles-link").off("click.stl").on("click.stl",{styles:t},G),e(v).eq(n.index).find(".stl-id-button-add").off("click.stl").on("click.stl",W),e(v).eq(n.index).find(".stl-id-favorite").bind("click",it),e(v).eq(n.index).find('[href="#find-in-store-overlay"]').bind("click",{styles:t,productSelected:n},st),e("#product-details-selected-size").val(e(v).eq(n.index).find(".selectric-size-select").val())):(e(".stlu-item").eq(n.index).find('[href="#find-in-store-overlay"]').bind("click",{styles:t,productSelected:n},st),e(".stlu-item").eq(n.index).find(".stl-id-favorite").bind("click",it))}function V(t,n){var r=t.description,i=null;return e.each(t.styles,function(s,o){t.styles[s]=e.extend({},o,{description:r,styleVariations:t.colorVariantNumber,itemID:t.itemId,sizeGuideHtml:t.sizeGuideHtml,index:t.indexItem,look:O,lookName:t.lookName,inStock:M}),o.id===n&&(i=t.styles[s])}),i}function $(){A=[],B=0,L=!1}function J(t){var n=t.inStock?S:x,r;e(".shop-the-look-unavailable-header").show(),B++;var i="ShopTheLookPage";t.position=B,t.url=hybris.contextPath+t.url+"?listName="+i+"&position="+B,e(g).hide(),r=E(t),n.append(r),e(".sizeguide-placeholder").append(t.sizeGuideHtml),U(n.find(v).eq(t.index),t),z(n.find(v).eq(t.index),t),X(A[B-1],t),R(n.find(v).eq(t.index),B),H===B&&(I(),e(".shop-the-look-unavailable-header").addClass("_loaded"),e(".stl-id-action-item-link").on("click",function(e){e.preventDefault()}),t.inStock&&e(".shop-the-look-unavailable-header").hide()),rt(t)}function K(t){var n=e(t.data.context),r=e(".shop-the-look-carousel-available"),i=N.find(".slick-center").data("id"),s=t.data.product,o=t.data.originalProduct;c.close(N),e(y,r).slick("unslick"),e(".style-selector-overlay-wrapper",N).remove(),e.each(s,function(e,t){t.id===i&&(t.styleVariations=o.colorVariantNumber,t.itemID=o.itemId,t.index=o.indexItem,z(n,t),U(n,t,"update"),X(A[n.index()],t))})}function Q(e,t){var n=N.find(".btn-select-style, .carousel-slide");n.bind("click",{context:e,product:t.styles,originalProduct:t},K)}function G(n){var r,s=e.extend({},n),o,f=e(this).closest(v),l=typeof n.data.styles.styles[0]!="undefined"&&typeof n.data.styles.styles!="undefined"?n.data.styles.styles[0].styleCode:"",c=t.endPointAccess(w,"styleCode="+l);c.done(function(t){s.data.styles.styles=t,N.empty(),r=T(s.data.styles),N.html(r);var n=e(".container-carousel-style-selector");o=a.getConfig(n),e(y,n).slick(o),u.unLoad(),u.load(),i.loadImage(N),Q(f,s.data.styles),e(m).removeAttr("style").css("padding","0 "+(e(".style-selector-overlay-content").width()-e(m).width())/2+"px")})}function Y(e){var t,n="indexItem";for(var r=0;r<e.length;r++)Object.defineProperty(e[r],n,{value:r}),t=j(e[r]),A.push(e[r]),J(V(e[r],t));o.fillSavedItems()}function Z(n,r,i){var s=e(".main-carousel-shop-the-look"),o=s.find(".slick-track"),u=o.find(".slick-active"),a=u.prev(),f=a.data("lookid"),l=u.next(),c=l.data("lookid"),h="lookId="+u.data("lookid").toString(),p=o.find(".carousel-slide").index(".slick-active"),d,v,m,g=p;_?i?(D=_,_=P,nt(_,g),m=t.endPointAccess(n,"lookId="+c),m.done(function(e){P=e,et()})):(P=_,_=D,nt(_,g),v=t.endPointAccess(n,"lookId="+f),v.done(function(e){D=e,et()})):(d=t.endPointAccess(n,h),d.done(function(e){_=e,nt(_,g),v=t.endPointAccess(n,"lookId="+f),m=t.endPointAccess(n,"lookId="+c),v.done(function(e){D=e,et()}),m.done(function(e){P=e,et()})}))}function et(){e(".stl-id-sizes select").each(function(){e(this).find("option").length>5&&e(this).parents(".selectricWrapper").find(".selectricItems").addClass("size-scrollable")})}function tt(t,n){O=n+=1,e(".shop-the-look-items-container").empty(),$(),H=t.inStockItems.length+t.outOfStockItems.length,e(".sizeguide-placeholder").empty(),M=1,Y(t.inStockItems),typeof t.inStockItems=="undefined"||t.inStockItems.length===0?S.hide():S.show(),M=0,Y(t.outOfStockItems),e(".size-guide-link").each(function(){var t=e(this).attr("href");e(t).length===0&&e(this).hide()})}function nt(e,t){tt(_,t)}function rt(e){if(typeof e!="undefined"){var t={},n={},r={},i={};i.name=e.title,i.id=e.styleCode,i.price=e.rawPrice,i.category=e.categoryPath,i.variant=e.variantText,i.position=e.position;var s=[i];n.actionField={list:"ShopTheLookPage"},n.products=s,r.detail=n,t.ecommerce=r,t.event="viewProductDetail",dataLayer.push(t)}}function it(){var t=e(this),n=t.closest(".stl-item-details").find(".size-select").val();typeof n=="undefined"||n==-1?e("#product-details-selected-size").val(e(this).data("save-item")):e("#product-details-selected-size").val(n)}function st(t){var n=e(this),r=e("#find-in-store-overlay .size-select"),i=n.closest(".stl-item-details").find(".size-select").val();e(".find-in-store-product-title").text(t.data.productSelected.title),e(".find-in-store-style-number-title").text(t.data.productSelected.styleNumber),e(".find-in-store-product-selected-price span").text(t.data.productSelected.price),t.data.productSelected.onlySize?e(".find-in-store-overlay-wrapper .product-detail-size-select").hide():e(".find-in-store-overlay-wrapper .product-detail-size-select").show(),r.empty(),r.append('<option value="-1" disabled >Select size</option>');for(var s in t.data.productSelected.sizes){var o=t.data.productSelected.sizes[s];typeof o!="undefined"&&r.append('<option value="'+o.id+'" data-copy="'+o.label+'" data-copy-device="'+o.label+'" data-available="'+o.availableOnline+'" >'+o.label+" </option> ")}if(i!=="undefined"&&i!=-1){var u=e('option[value="'+i+'"]',r).index();r.prop("selectedIndex",u)}r.selectric("init").selectric("refresh");var a=t.data.productSelected.findInStoreImage;typeof a!="undefined"&&e(".find-in-store-product-selected-image").html(' <img alt="'+t.data.productSelected.title+'" class="find-in-store-product-image" '+' data-src="'+a.src+'" '+' data-src_medium="'+a.datasrcmedium+'"  '+' data-src_medium_retina="'+a.datasrcmediumretina+'" '+' data-src_small="'+a.datasrcsmall+'" '+' data-src_small_retina="'+a.datasrcsmallretina+'" '+' data-src_standard="'+a.datasrcstandard+'" '+' data-src_standard_retina="'+a.datasrcstandardretina+'" '+' src="'+a.src+'" /> '),e(".stores-map-index").show(),e(".stores-map-results").hide()}var p="inStockItems",d="selectedStyleId",v=".stl-item",m=".style-selector-carousel",g=".carousel-counter",y=".carousel-inner",b=".initials-personalization-content",w="SHOP-THE-LOOK-STYLE",E=r.compile(e("#shop-the-look-item").html()),S=e(".shop-the-look-available"),x=e(".shop-the-look-unavailable"),T=r.compile(e("#shop-the-look-style-selector-overlay-template").html()),N=e("#style-selector-overlay"),C=r.compile(e("#carousel-images-template").html()),k=r.compile(e("#mini-product-details-template").html()),L=!1,A=[],O,M,_,D,P,H=0,B=0;return{loadServices:function(e,t){Z(e,t),f.change(function(){n.unReelAllImg(),setTimeout(function(){n.initComponents()},500)})},servicesIsLoaded:function(){return F()},getCurrentLook:function(e,t,n){Z(e,t,n)}}});
